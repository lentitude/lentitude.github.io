<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>做一款可用的天气 APP | blogs</title><meta name="keywords" content="APP"><meta name="author" content="lentitude"><meta name="copyright" content="lentitude"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="可能很多人会问：之前已经写过一篇博文来介绍怎么做一款简单的新闻APP，为什么还要专门一篇来介绍怎么做一款天气 APP，毕竟网络请求和数据处理都是大同小异的。如果真的要说差别的话，前一篇只是具备了一些基本的功能，来说明怎么请求和处理返回的数据，但还不足与在日常生活中使用？这一篇实践是来做一款日常可用的天气 APP - 彼时天气">
<meta property="og:type" content="article">
<meta property="og:title" content="做一款可用的天气 APP">
<meta property="og:url" content="https://github.com/lentitude/lentitude.github.io/2017/12/22/%E5%81%9A%E4%B8%80%E6%AC%BE%E5%8F%AF%E7%94%A8%E7%9A%84%E5%A4%A9%E6%B0%94-APP/index.html">
<meta property="og:site_name" content="blogs">
<meta property="og:description" content="可能很多人会问：之前已经写过一篇博文来介绍怎么做一款简单的新闻APP，为什么还要专门一篇来介绍怎么做一款天气 APP，毕竟网络请求和数据处理都是大同小异的。如果真的要说差别的话，前一篇只是具备了一些基本的功能，来说明怎么请求和处理返回的数据，但还不足与在日常生活中使用？这一篇实践是来做一款日常可用的天气 APP - 彼时天气">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2017-12-22T04:48:57.000Z">
<meta property="article:modified_time" content="2020-03-26T05:18:54.000Z">
<meta property="article:author" content="lentitude">
<meta property="article:tag" content="APP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/lentitude/lentitude.github.io/img/favicon.png"><link rel="canonical" href="https://github.com/lentitude/lentitude.github.io/2017/12/22/%E5%81%9A%E4%B8%80%E6%AC%BE%E5%8F%AF%E7%94%A8%E7%9A%84%E5%A4%A9%E6%B0%94-APP/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/lentitude/lentitude.github.io/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/lentitude/lentitude.github.io/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '做一款可用的天气 APP',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-03-26 13:18:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/lentitude/lentitude.github.io/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/lentitude/lentitude.github.io/tags/"><div class="headline">标签</div><div class="length-num">22</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/lentitude/lentitude.github.io/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/lentitude/lentitude.github.io/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/lentitude/lentitude.github.io/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/lentitude/lentitude.github.io/">blogs</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/lentitude/lentitude.github.io/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/lentitude/lentitude.github.io/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/lentitude/lentitude.github.io/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">做一款可用的天气 APP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2017-12-22T04:48:57.000Z" title="发表于 2017-12-22 12:48:57">2017-12-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-03-26T05:18:54.000Z" title="更新于 2020-03-26 13:18:54">2020-03-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/lentitude/lentitude.github.io/categories/Android/">Android</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="做一款可用的天气 APP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>可能很多人会问：之前已经写过一篇博文来介绍怎么做一款简单的<a target="_blank" rel="noopener" href="https://lentitude.github.io/2017/12/22/%E5%81%9A%E4%B8%80%E6%AC%BE%E6%96%B0%E9%97%BB-APP/#more">新闻APP</a>，为什么还要专门一篇来介绍怎么做一款天气 APP，毕竟网络请求和数据处理都是大同小异的。如果真的要说差别的话，前一篇只是具备了一些基本的功能，来说明怎么请求和处理返回的数据，但还不足与在日常生活中使用？这一篇实践是来做一款<strong>日常可用</strong>的天气 APP - 彼时天气</p>
<span id="more"></span>

<p>—- 说明： 彼时天气仿照魅族 Flyme 天气设计<br>—- 在 coolWeather 的基础上进行处理</p>
<hr>
<h2 id="总体思路"><a href="#总体思路" class="headerlink" title="总体思路"></a>总体思路</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: 开始</span><br><span class="line">e=&gt;end: 结束</span><br><span class="line">cond=&gt;condition: 有无缓存？</span><br><span class="line">cond1=&gt;condition: 有无网络？</span><br><span class="line">op=&gt;operation: 直接加载缓存文件</span><br><span class="line">op1=&gt;operation: 直接退出</span><br><span class="line">op2=&gt;operation: 通过百度SDK 获取位置</span><br><span class="line">op3=&gt;operation: OKHttp向接口请求对应位置的天气信息</span><br><span class="line">op4=&gt;operation: GSON 对返回的数据进行解析</span><br><span class="line">op5=&gt;operation: 将返回的数据显示并写入缓存文件</span><br><span class="line"></span><br><span class="line">st-&gt;cond</span><br><span class="line">cond(no)-&gt;cond1</span><br><span class="line">cond(yes)-&gt;op</span><br><span class="line">cond1(no)-&gt;op1</span><br><span class="line">cond1(yes)-&gt;op2</span><br><span class="line">op2-&gt;op3</span><br><span class="line">op3-&gt;op4</span><br><span class="line">op4-&gt;op5</span><br></pre></td></tr></table></figure>

<p>这就是总体的设计思路，至于后面其他的功能：选择地区，更新频率等功能可以之后再说</p>
<hr>
<h2 id="运行GIF"><a href="#运行GIF" class="headerlink" title="运行GIF"></a>运行GIF</h2><center>![这里写图片描述](http://img.blog.csdn.net/20170516174414172?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWl3ZWkxMg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

<p>之所以大幅度提前展示 GIF 图，方便对后面布局部分有更好的理解</p>
<hr>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol start="0">
<li>声明权限</li>
<li>依赖库</li>
<li>网络请求</li>
<li>网络解析</li>
<li>界面布局</li>
<li>最后</li>
<li>完整代码下载地址（github）</li>
</ol>
<hr>
<h3 id="声明权限"><a href="#声明权限" class="headerlink" title="声明权限"></a>声明权限</h3><p>因为我们需要用到百度SDK的定位服务，所以需要先下载百度中包含基础定位的 <a target="_blank" rel="noopener" href="http://lbsyun.baidu.com/sdk/download">SDK</a> 。解压后，将其中的 .jar 文件移动到 libs 文件夹中，在 main 目录下新建一个 jniLibs，将剩下的几个文件夹复制到里面，点击 Sync 按钮进行同步。 在 AndroidManifest 文件中声明权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.MOUNT_UNMOUNT_FILESYSTEMS&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>基本上都是 百度SDK 所需要的权限，其中部分权限是需要进行运行时处理的。同时还需要添加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">           android:name=&quot;com.baidu.lbsapi.API_KEY&quot;</span><br><span class="line">           android:value=&quot;SmwjePIXo1eeRGbjw8QKrbncWfgi5V0f&quot; /&gt;</span><br><span class="line"></span><br><span class="line">       &lt;service</span><br><span class="line">           android:name=&quot;com.baidu.location.f&quot;</span><br><span class="line">           android:enabled=&quot;true&quot;</span><br><span class="line">           android:process=&quot;:remote&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>value 中填写自己申请获取的 Key，其他的格式都是固定的，这样我们就可以调用 基础定位 中的功能了</p>
<hr>
<h3 id="依赖库"><a href="#依赖库" class="headerlink" title="依赖库"></a>依赖库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">compile &#x27;org.litepal.android:core:1.4.1&#x27;               // 数据库框架</span><br><span class="line">compile &#x27;com.squareup.okhttp3:okhttp:3.4.1&#x27;            // 网络请求</span><br><span class="line">compile &#x27;com.google.code.gson:gson:2.7&#x27;                // 网络解析</span><br><span class="line">compile &#x27;com.github.bumptech.glide:glide:3.8.0&#x27;        // 图片加载</span><br><span class="line">compile &#x27;com.android.support:cardview-v7:24.2.1&#x27;       // 卡片式布局</span><br><span class="line">compile &#x27;com.android.support:design:24.2.1&#x27;            // Material Design中用到的依赖库</span><br><span class="line">compile &#x27;net.danlew:android.joda:2.9.9&#x27;                // 时间处理</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class HttpUtil &#123;</span><br><span class="line">    public static void sendOkHttpRequest(String address, okhttp3.Callback callback)&#123;</span><br><span class="line">        OkHttpClient client = new OkHttpClient();</span><br><span class="line">        Request request = new Request.Builder().url(address).build();</span><br><span class="line">        client.newCall(request).enqueue(callback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="网络解析"><a href="#网络解析" class="headerlink" title="网络解析"></a>网络解析</h3><p>本次的数据来源是 <a target="_blank" rel="noopener" href="https://www.heweather.com/documents/api/v5/weather">和风天气</a>，O(∩_∩)O哈哈~第一行代码的同学有没有很熟悉</p>
<center>![这里写图片描述](http://img.blog.csdn.net/20170516165652217?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWl3ZWkxMg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
参数


<center>![这里写图片描述](http://img.blog.csdn.net/20170516170310725?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWl3ZWkxMg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
请求地址


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;HeWeather5&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;alarms&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;level&quot;: &quot;蓝色&quot;,</span><br><span class="line">                    &quot;stat&quot;: &quot;预警中&quot;,</span><br><span class="line">                    &quot;title&quot;: &quot;山东省青岛市气象台发布大风蓝色预警&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;青岛市气象台2016年08月29日15时24分继续发布大风蓝色预警信号：预计今天下午到明天，我市北风风力海上6到7级阵风9级，陆地4到5阵风7级，请注意防范。&quot;,</span><br><span class="line">                    &quot;type&quot;: &quot;大风&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;aqi&quot;: &#123;</span><br><span class="line">                &quot;city&quot;: &#123;</span><br><span class="line">                    &quot;aqi&quot;: &quot;60&quot;,</span><br><span class="line">                    &quot;co&quot;: &quot;0&quot;,</span><br><span class="line">                    &quot;no2&quot;: &quot;14&quot;,</span><br><span class="line">                    &quot;o3&quot;: &quot;95&quot;,</span><br><span class="line">                    &quot;pm10&quot;: &quot;67&quot;,</span><br><span class="line">                    &quot;pm25&quot;: &quot;15&quot;,</span><br><span class="line">                    &quot;qlty&quot;: &quot;良&quot;,  //共六个级别，分别：优，良，轻度污染，中度污染，重度污染，严重污染</span><br><span class="line">                    &quot;so2&quot;: &quot;10&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;basic&quot;: &#123;</span><br><span class="line">                &quot;city&quot;: &quot;青岛&quot;,</span><br><span class="line">                &quot;cnty&quot;: &quot;中国&quot;,</span><br><span class="line">                &quot;id&quot;: &quot;CN101120201&quot;,</span><br><span class="line">                &quot;lat&quot;: &quot;36.088000&quot;,</span><br><span class="line">                &quot;lon&quot;: &quot;120.343000&quot;,</span><br><span class="line">                &quot;prov&quot;: &quot;山东&quot;  //城市所属省份（仅限国内城市）</span><br><span class="line">                &quot;update&quot;: &#123;</span><br><span class="line">                    &quot;loc&quot;: &quot;2016-08-30 11:52&quot;,</span><br><span class="line">                    &quot;utc&quot;: &quot;2016-08-30 03:52&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;daily_forecast&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;astro&quot;: &#123;</span><br><span class="line">                        &quot;mr&quot;: &quot;03:09&quot;,</span><br><span class="line">                        &quot;ms&quot;: &quot;17:06&quot;,</span><br><span class="line">                        &quot;sr&quot;: &quot;05:28&quot;,</span><br><span class="line">                        &quot;ss&quot;: &quot;18:29&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;cond&quot;: &#123;</span><br><span class="line">                        &quot;code_d&quot;: &quot;100&quot;,</span><br><span class="line">                        &quot;code_n&quot;: &quot;100&quot;,</span><br><span class="line">                        &quot;txt_d&quot;: &quot;晴&quot;,</span><br><span class="line">                        &quot;txt_n&quot;: &quot;晴&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;date&quot;: &quot;2016-08-30&quot;,</span><br><span class="line">                    &quot;hum&quot;: &quot;45&quot;,</span><br><span class="line">                    &quot;pcpn&quot;: &quot;0.0&quot;,</span><br><span class="line">                    &quot;pop&quot;: &quot;8&quot;,</span><br><span class="line">                    &quot;pres&quot;: &quot;1005&quot;,</span><br><span class="line">                    &quot;tmp&quot;: &#123;</span><br><span class="line">                        &quot;max&quot;: &quot;29&quot;,</span><br><span class="line">                        &quot;min&quot;: &quot;22&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;vis&quot;: &quot;10&quot;,</span><br><span class="line">                    &quot;wind&quot;: &#123;</span><br><span class="line">                        &quot;deg&quot;: &quot;339&quot;,</span><br><span class="line">                        &quot;dir&quot;: &quot;北风&quot;,</span><br><span class="line">                        &quot;sc&quot;: &quot;4-5&quot;,</span><br><span class="line">                        &quot;spd&quot;: &quot;24&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;hourly_forecast&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;cond&quot;: &#123;</span><br><span class="line">                        &quot;code&quot;: &quot;100&quot;,</span><br><span class="line">                        &quot;txt&quot;: &quot;晴&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;date&quot;: &quot;2016-08-30 12:00&quot;,</span><br><span class="line">                    &quot;hum&quot;: &quot;47&quot;,</span><br><span class="line">                    &quot;pop&quot;: &quot;0&quot;,</span><br><span class="line">                    &quot;pres&quot;: &quot;1006&quot;,</span><br><span class="line">                    &quot;tmp&quot;: &quot;29&quot;,</span><br><span class="line">                    &quot;wind&quot;: &#123;</span><br><span class="line">                        &quot;deg&quot;: &quot;335&quot;,</span><br><span class="line">                        &quot;dir&quot;: &quot;西北风&quot;,</span><br><span class="line">                        &quot;sc&quot;: &quot;4-5&quot;,</span><br><span class="line">                        &quot;spd&quot;: &quot;36&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;now&quot;: &#123;</span><br><span class="line">                &quot;cond&quot;: &#123;</span><br><span class="line">                    &quot;code&quot;: &quot;100&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;晴&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;fl&quot;: &quot;28&quot;,</span><br><span class="line">                &quot;hum&quot;: &quot;41&quot;,</span><br><span class="line">                &quot;pcpn&quot;: &quot;0&quot;,</span><br><span class="line">                &quot;pres&quot;: &quot;1005&quot;,</span><br><span class="line">                &quot;tmp&quot;: &quot;26&quot;,</span><br><span class="line">                &quot;vis&quot;: &quot;10&quot;,</span><br><span class="line">                &quot;wind&quot;: &#123;</span><br><span class="line">                    &quot;deg&quot;: &quot;330&quot;,</span><br><span class="line">                    &quot;dir&quot;: &quot;西北风&quot;,</span><br><span class="line">                    &quot;sc&quot;: &quot;6-7&quot;,</span><br><span class="line">                    &quot;spd&quot;: &quot;34&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;status&quot;: &quot;ok&quot;,</span><br><span class="line">            &quot;suggestion&quot;: &#123;</span><br><span class="line">                &quot;comf&quot;: &#123;</span><br><span class="line">                    &quot;brf&quot;: &quot;较舒适&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;白天天气晴好，您在这种天气条件下，会感觉早晚凉爽、舒适，午后偏热。&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;cw&quot;: &#123;</span><br><span class="line">                    &quot;brf&quot;: &quot;较不宜&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;较不宜洗车，未来一天无雨，风力较大，如果执意擦洗汽车，要做好蒙上污垢的心理准备。&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;drsg&quot;: &#123;</span><br><span class="line">                    &quot;brf&quot;: &quot;热&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;天气热，建议着短裙、短裤、短薄外套、T恤等夏季服装。&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;flu&quot;: &#123;</span><br><span class="line">                    &quot;brf&quot;: &quot;较易发&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;虽然温度适宜但风力较大，仍较易发生感冒，体质较弱的朋友请注意适当防护。&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;sport&quot;: &#123;</span><br><span class="line">                    &quot;brf&quot;: &quot;较适宜&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;天气较好，但风力较大，推荐您进行室内运动，若在户外运动请注意防风。&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;trav&quot;: &#123;</span><br><span class="line">                    &quot;brf&quot;: &quot;适宜&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;天气较好，风稍大，但温度适宜，是个好天气哦。适宜旅游，您可以尽情地享受大自然的无限风光。&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;uv&quot;: &#123;</span><br><span class="line">                    &quot;brf&quot;: &quot;强&quot;,</span><br><span class="line">                    &quot;txt&quot;: &quot;紫外线辐射强，建议涂擦SPF20左右、PA++的防晒护肤品。避免在10点至14点暴露于日光下。&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<center>返回类型示例



<p>我们后面申请数据采用的参数都为 <strong>城市名称</strong>，从返回示例中我们可以看出，结构和我们上次新闻API 返回的结构是有差异的，多嵌套了一层，不过 GSON 解析的方式还是一样的。在包名下新建一个 gson 文件夹，在里面新建对应数据的实体类：</p>
<p>AQI.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class AQI &#123;</span><br><span class="line"></span><br><span class="line">    public AQICity city;</span><br><span class="line"></span><br><span class="line">    public class AQICity&#123;</span><br><span class="line">        public String aqi;</span><br><span class="line">        public String pm25;</span><br><span class="line">        public String co;</span><br><span class="line">        public String o3;</span><br><span class="line">        public String pm10;</span><br><span class="line">        public String so2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Basic.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Basic &#123;</span><br><span class="line">    @SerializedName(&quot;city&quot;)</span><br><span class="line">    public String cityName;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;id&quot;)</span><br><span class="line">    public String weatherId;</span><br><span class="line"></span><br><span class="line">    public  Update update;</span><br><span class="line"></span><br><span class="line">    public class Update&#123;</span><br><span class="line">        public String loc;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>Forecast.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class Forecast &#123;</span><br><span class="line"></span><br><span class="line">    public String date;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;tmp&quot;)</span><br><span class="line">    public Temperature temperature;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;cond&quot;)</span><br><span class="line">    public More more;</span><br><span class="line"></span><br><span class="line">    public class More&#123;</span><br><span class="line">        @SerializedName(&quot;txt_d&quot;)</span><br><span class="line">        public String info;</span><br><span class="line"></span><br><span class="line">        @SerializedName(&quot;code_d&quot;)</span><br><span class="line">        public int code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Temperature&#123;</span><br><span class="line">        public String max;</span><br><span class="line">        public String min;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Hourly.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Hourly &#123;</span><br><span class="line"></span><br><span class="line">    public Cond cond;</span><br><span class="line"></span><br><span class="line">    public class Cond&#123;</span><br><span class="line"></span><br><span class="line">        public String code;</span><br><span class="line"></span><br><span class="line">        public String txt;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String date;</span><br><span class="line"></span><br><span class="line">    public String tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Now &#123;</span><br><span class="line">    @SerializedName(&quot;tmp&quot;)</span><br><span class="line">    public String temperature;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;cond&quot;)</span><br><span class="line">    public More more;</span><br><span class="line"></span><br><span class="line">    public class More&#123;</span><br><span class="line">        @SerializedName(&quot;txt&quot;)</span><br><span class="line">        public String info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Suggestion.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">public class Suggestion &#123;</span><br><span class="line">    @SerializedName(&quot;comf&quot;)</span><br><span class="line">    public Comfort comfort;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;cw&quot;)</span><br><span class="line">    public CarWash carWash;</span><br><span class="line"></span><br><span class="line">    public Sport sport;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;drsg&quot;)</span><br><span class="line">    public Clothes clothes;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;flu&quot;)</span><br><span class="line">    public Cold cold;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public UV uv;</span><br><span class="line"></span><br><span class="line">    public class UV&#123;</span><br><span class="line">        @SerializedName(&quot;txt&quot;)</span><br><span class="line">        public String info;</span><br><span class="line"></span><br><span class="line">        @SerializedName(&quot;brf&quot;)</span><br><span class="line">        public String sign;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Cold&#123;</span><br><span class="line">        @SerializedName(&quot;txt&quot;)</span><br><span class="line">        public String info;</span><br><span class="line"></span><br><span class="line">        @SerializedName(&quot;brf&quot;)</span><br><span class="line">        public String sign;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Clothes&#123;</span><br><span class="line">        @SerializedName(&quot;txt&quot;)</span><br><span class="line">        public String info;</span><br><span class="line"></span><br><span class="line">        @SerializedName(&quot;brf&quot;)</span><br><span class="line">        public String sign;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Comfort&#123;</span><br><span class="line">        @SerializedName(&quot;txt&quot;)</span><br><span class="line">        public String info;</span><br><span class="line"></span><br><span class="line">        @SerializedName(&quot;brf&quot;)</span><br><span class="line">        public String sign;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class CarWash&#123;</span><br><span class="line">        @SerializedName(&quot;txt&quot;)</span><br><span class="line">        public String info;</span><br><span class="line"></span><br><span class="line">        @SerializedName(&quot;brf&quot;)</span><br><span class="line">        public String sign;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Sport&#123;</span><br><span class="line">        @SerializedName(&quot;txt&quot;)</span><br><span class="line">        public String info;</span><br><span class="line"></span><br><span class="line">        @SerializedName(&quot;brf&quot;)</span><br><span class="line">        public String sign;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后就是返回数据的对应实体类 Weather.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Weather &#123;</span><br><span class="line"></span><br><span class="line">    public String status;</span><br><span class="line"></span><br><span class="line">    public Basic basic;</span><br><span class="line"></span><br><span class="line">    public AQI aqi;</span><br><span class="line"></span><br><span class="line">    public Now now;</span><br><span class="line"></span><br><span class="line">    public Suggestion suggestion;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;daily_forecast&quot;)</span><br><span class="line">    public List&lt;Forecast&gt; forecastList;</span><br><span class="line"></span><br><span class="line">    @SerializedName(&quot;hourly_forecast&quot;)</span><br><span class="line">    public List&lt;Hourly&gt; hourlyList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在包名下新建目录 util ， 在其中新建类：Utility.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class Utility &#123;</span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * 处理得到的 weather 数据，转化为 weather 对象</span><br><span class="line">     */</span><br><span class="line">    public static Weather handleWeatherResponse(String response)&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            JSONObject jsonObject = new JSONObject(response);</span><br><span class="line">            JSONArray jsonArray = jsonObject.getJSONArray(&quot;HeWeather5&quot;);</span><br><span class="line">            String weatherContent = jsonArray.getJSONObject(0).toString();</span><br><span class="line">            return new Gson().fromJson(weatherContent, Weather.class);</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="界面布局"><a href="#界面布局" class="headerlink" title="界面布局"></a>界面布局</h3><p>相信大家都看了运行的 GIF 图，可以看到主界面的布局还是比较繁琐的，所以引入布局不失为一个好的选择，主界面布局主要分为以下几个部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">weather_title（标题栏）</span><br><span class="line">weather_now（当前天气信息）</span><br><span class="line">weather_hourly（小时天气预报）</span><br><span class="line">weather_forecast（未来几天的天气预报）</span><br><span class="line">weather_aqi（空气质量）</span><br><span class="line">weather_suggestion（生活建议）</span><br></pre></td></tr></table></figure>

<p>以下是各部分的代码：</p>
<p>weather_title：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;android.support.v7.widget.Toolbar xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;?attr/actionBarSize&quot;</span><br><span class="line">    android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">    app:popupTheme=&quot;@style/ToolbarPopupTheme&quot;</span><br><span class="line">    app:subtitleTextColor=&quot;@color/colorFont&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/title_city&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_horizontal&quot;</span><br><span class="line">        android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">        android:textSize=&quot;20sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/android.support.v7.widget.Toolbar&gt;</span><br></pre></td></tr></table></figure>

<p>Toolbar 中间放置了 title_city ，用来显示当前的城市名</p>
<p>weather_now</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;400dp&quot;</span><br><span class="line">    android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:id=&quot;@+id/weather_now_layout&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/degree_text&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">            android:textSize=&quot;120sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_toRightOf=&quot;@+id/degree_text&quot;</span><br><span class="line">            android:layout_alignTop=&quot;@+id/degree_text&quot;</span><br><span class="line">            android:text=&quot;°&quot;</span><br><span class="line">            android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">            android:textSize=&quot;120sp&quot;</span><br><span class="line">            /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/weather_info_text&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_above=&quot;@+id/degree_text&quot;</span><br><span class="line">            android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">            android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">            android:textSize=&quot;20sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/update_time_text&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_below=&quot;@+id/degree_text&quot;</span><br><span class="line">            android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">            android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">            android:textSize=&quot;12sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure>

<p>在视图中间，从上至下放置了三个TextView 控件：weather_info_text（天气状况），degree_text（天气温度），update_time_text（数据更新时间），另外一个“°”符号放在温度的右上角</p>
<p>weather_hourly：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;100dp&quot;</span><br><span class="line">    android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.RecyclerView</span><br><span class="line">        android:id=&quot;@+id/weather_hourly&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>为了支持小时天气预报部分可以直接水平滑动（不过免费用户可以得到的数据量好像不需要滑动 2333333），放置了一个 RecyclerView</p>
<p>weather_hourly_item</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;80dp&quot;</span><br><span class="line">    android:layout_height=&quot;100dp&quot;</span><br><span class="line">    android:padding=&quot;10dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/hour_text&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">        android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">        android:textSize=&quot;14sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/hour_degree&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">        android:textSize=&quot;14sp&quot;</span><br><span class="line">        android:layout_below=&quot;@+id/hour_text&quot;</span><br><span class="line">        android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">        android:layout_marginTop=&quot;4dp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/hout_time&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">        android:textSize=&quot;14sp&quot;</span><br><span class="line">        android:layout_above=&quot;@+id/hour_text&quot;</span><br><span class="line">        android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">        android:layout_marginBottom=&quot;4dp&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure>

<p>小时天气预报的每个子项中，从上到下放置了三个TextView控件：hour_degree（天气温度），hour_text（天气描述），hout_time（时间）</p>
<p>weather_forecast：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=&quot;@+id/forecast_layout&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>这里采用的还是原方案，直接设置一个 LinearLayout 布局，后面直接在其中添加子布局，当然，大家也可以选用一个 ListView 来显示内容</p>
<p>weather_forecast_item</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_margin=&quot;15dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/data_text&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_vertical&quot;</span><br><span class="line">        android:gravity=&quot;left&quot;</span><br><span class="line">        android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;ImageView</span><br><span class="line">            android:id=&quot;@+id/weather_pic&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_gravity=&quot;center_vertical|right&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/info_text&quot;</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;15dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;center_vertical|left&quot;</span><br><span class="line">            android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">            android:gravity=&quot;left&quot;</span><br><span class="line">            /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/max_min_text&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:gravity=&quot;right&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_vertical&quot;</span><br><span class="line">        android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>子项中水平放置了四个控件：data_text（预报日期），weather_pic（天气图片），info_text（天气信息），max_min_text（当天温度）</p>
<p>weather_aqi：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;75dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            &gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/aqi_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_gravity=&quot;center&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/aqi_text&quot;</span><br><span class="line">                android:text=&quot;AQI 指数&quot;</span><br><span class="line">                android:textSize=&quot;10sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/pm25_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/pm25_text&quot;</span><br><span class="line">                android:text=&quot;PM2.5 指数&quot;</span><br><span class="line">                android:textSize=&quot;10sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/co_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/co_text&quot;</span><br><span class="line">                android:text=&quot;CO 指数&quot;</span><br><span class="line">                android:textSize=&quot;10sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;75dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/o3_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/o3_text&quot;</span><br><span class="line">                android:text=&quot;O3 指数&quot;</span><br><span class="line">                android:textSize=&quot;10sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/pm10_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/pm10_text&quot;</span><br><span class="line">                android:text=&quot;PM10 指数&quot;</span><br><span class="line">                android:textSize=&quot;10sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            &gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/so2_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/so2_text&quot;</span><br><span class="line">                android:text=&quot;SO2 指数&quot;</span><br><span class="line">                android:textSize=&quot;10sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>这里有个 2 × 3布局，上面一行为：aqi_text（AQI指数），pm25_text（PM2.5 指数），co_text（CO 指数），下面一行为：o3_text（O3 指数），pm10_text（PM10 指数），so2_text（SO2 指数）</p>
<p>weather_suggestion：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;150dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;5dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;2.5dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line"></span><br><span class="line">            &gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/comfort_button&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/comfort&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:text=&quot;舒适指数&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;12sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=&quot;@+id/comfort_pic&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;50dp&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_above=&quot;@+id/comfort&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;10dp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/comfort_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorBlack&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/comfort&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;2.5dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;2.5dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/car_wash_button&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/car_wash&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:text=&quot;洗车指数&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;12sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=&quot;@+id/car_wash_pic&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;50dp&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_above=&quot;@+id/car_wash&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;10dp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/car_wash_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/car_wash&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorBlack&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;2.5dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;5dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/sport_button&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/sport&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:text=&quot;运动指数&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;12sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=&quot;@+id/sport_pic&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;50dp&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_above=&quot;@+id/sport&quot;</span><br><span class="line">                android:scaleType=&quot;centerCrop&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/sport_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/sport&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorBlack&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;150dp&quot;</span><br><span class="line">        android:layout_marginTop=&quot;5dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;5dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;2.5dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/cold_button&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/cold&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:text=&quot;感冒指数&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;12sp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=&quot;@+id/cold_pic&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;50dp&quot;</span><br><span class="line">                android:layout_above=&quot;@+id/cold&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:scaleType=&quot;centerCrop&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/cold_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/cold&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorBlack&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;2.5dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;2.5dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/clothes_button&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/clothes&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:text=&quot;穿衣指数&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;12sp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=&quot;@+id/colthes_pic&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;50dp&quot;</span><br><span class="line">                android:layout_above=&quot;@+id/clothes&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/clothes_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/clothes&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorBlack&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width=&quot;0dp&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;2.5dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;5dp&quot;</span><br><span class="line">            android:layout_weight=&quot;1&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/uv_button&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/uv&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">                android:text=&quot;紫外线指数&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;12sp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=&quot;@+id/uv_pic&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;50dp&quot;</span><br><span class="line">                android:layout_above=&quot;@+id/uv&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:layout_marginBottom=&quot;10dp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/uv_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_below=&quot;@+id/uv&quot;</span><br><span class="line">                android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorBlack&quot;</span><br><span class="line">                android:textSize=&quot;18sp&quot; /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>也是2×3布局，上面一行为：comfort_text（舒适指数），car_wash_text（洗车指数），sport_text（运动指数），下面一行为：cold_text（感冒指数），clothes_text（穿衣指数），uv_text（紫外线指数）。在每个布局外面覆盖了一个 Button。除此之外，每个 text 都放置了一个 ImageView，用来放置对应的图片，不过这里没有放置，大家可以不用管</p>
<p>activity_main</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;android.support.design.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:id=&quot;@+id/coor_layout&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:background=&quot;@color/colorBackground&quot;</span><br><span class="line">    android:visibility=&quot;invisible&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.design.widget.AppBarLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        app:elevation=&quot;0dp&quot;</span><br><span class="line">        &gt;</span><br><span class="line"></span><br><span class="line">        &lt;include</span><br><span class="line">            android:id=&quot;@+id/tool_bar&quot;</span><br><span class="line">            layout=&quot;@layout/weather_title&quot;</span><br><span class="line">            app:layout_scrollFlags=&quot;scroll|enterAlways|snap&quot;</span><br><span class="line"></span><br><span class="line">            /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/android.support.design.widget.AppBarLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;android.support.v4.widget.SwipeRefreshLayout</span><br><span class="line">        android:id=&quot;@+id/swipe_refresh&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;</span><br><span class="line">        &gt;</span><br><span class="line"></span><br><span class="line">        &lt;ScrollView</span><br><span class="line">            android:id=&quot;@+id/weather_layout&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:scrollbars=&quot;none&quot;</span><br><span class="line">            android:overScrollMode=&quot;always&quot;</span><br><span class="line">            &gt;</span><br><span class="line"></span><br><span class="line">            &lt;LinearLayout</span><br><span class="line">                android:orientation=&quot;vertical&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_now&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_hourly&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_space&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_forecast&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_space&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_aqi&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_space&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_suggestion&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;include layout=&quot;@layout/weather_author&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/ScrollView&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/android.support.v4.widget.SwipeRefreshLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/android.support.design.widget.CoordinatorLayout&gt;</span><br></pre></td></tr></table></figure>
<p>引入对应的布局，布局 weather_space 是进行隔断处理的，这里可以看到最外层布局的可见属性为 <strong>invisible</strong>， 因为界面中存在很多不需要数据处理也可以显示的控件，不如摄氏度和描述性文字，解决方案是，默认不显示，在解析完数据之后重新设置属性为 <strong>visible</strong></p>
<p>BaseActivity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public abstract class BaseActivity extends AppCompatActivity implements View.OnClickListener&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        initView();</span><br><span class="line">        initData();</span><br><span class="line">        initListener();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 初始化控件</span><br><span class="line">    public abstract void initView();</span><br><span class="line"></span><br><span class="line">    // 初始化疏数据</span><br><span class="line">    public abstract void initData();</span><br><span class="line"></span><br><span class="line">    // 初始化监听器</span><br><span class="line">    public abstract void initListener();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 判断是否有网络</span><br><span class="line">    public NetworkInfo getNetworkInfo()&#123;</span><br><span class="line">        ConnectivityManager connectivityManager = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line">        NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();</span><br><span class="line">        return networkInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Toast 长时间</span><br><span class="line">    public void showShort(String msg)&#123;</span><br><span class="line">        Toast.makeText(this, msg, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，写了一个 BaseActivity ，还是推荐大家使用这样的方式，先自己创建一个基类，更加方便自己对代码进行结构化处理，这里我我定义了三个抽象函数：<code>initView() 初始化控件, initData() 初始化数据， initListener() 初始化监听器</code>  和两个定义好的函数：<code>根据 getNetworkInfo（）函数返回的结果判定是否存在网络， showShort（）就是对Toast 简单的包装</code> ，这样在 Activity 中只需要重写这几个方法即可</p>
<p>接下来是 MainActivity，代码冗长，按照定义的基类方法讲：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public void initView() &#123;</span><br><span class="line">        setContentView(R.layout.acticity_main);</span><br><span class="line"></span><br><span class="line">        Toolbar toolbar = (Toolbar)findViewById(R.id.tool_bar);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        ActionBar actionBar = getSupportActionBar();</span><br><span class="line">        if (actionBar != null)&#123;</span><br><span class="line">            actionBar.setDisplayShowTitleEnabled(false);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 初始化各种控件</span><br><span class="line"></span><br><span class="line">        weatherLayout = (ScrollView)findViewById(R.id.weather_layout);</span><br><span class="line">        titleCity = (TextView)findViewById(R.id.title_city);</span><br><span class="line">        forecastLayout = (LinearLayout)findViewById(R.id.forecast_layout);</span><br><span class="line">        coordinatorLayout = (CoordinatorLayout)findViewById(R.id.coor_layout);</span><br><span class="line"></span><br><span class="line">        // weather_now</span><br><span class="line">        degreeText = (TextView)findViewById(R.id.degree_text);</span><br><span class="line">        weatherInfoText = (TextView)findViewById(R.id.weather_info_text);</span><br><span class="line">        weaherNowLayout = (RelativeLayout)findViewById(R.id.weather_now_layout);</span><br><span class="line">        updateTimeText = (TextView)findViewById(R.id.update_time_text);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // weather_hour</span><br><span class="line">        hourDegree = (TextView)findViewById(R.id.hour_degree);</span><br><span class="line">        hourText = (TextView)findViewById(R.id.hour_text);</span><br><span class="line">        hourTime = (TextView)findViewById(R.id.hout_time);</span><br><span class="line"></span><br><span class="line">        recyclerView = (RecyclerView)findViewById(R.id.weather_hourly);</span><br><span class="line">        hourAdapter = new HourAdapter(hourList);</span><br><span class="line">        LinearLayoutManager linearLayoutManager = new LinearLayoutManager(this);</span><br><span class="line">        linearLayoutManager.setOrientation(LinearLayoutManager.HORIZONTAL);</span><br><span class="line">        recyclerView.setLayoutManager(linearLayoutManager);</span><br><span class="line">        recyclerView.setAdapter(hourAdapter);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // weather_aqi</span><br><span class="line">        aqiText = (TextView)findViewById(R.id.aqi_text);</span><br><span class="line">        pm25Text = (TextView)findViewById(R.id.pm25_text);</span><br><span class="line">        coText = (TextView)findViewById(R.id.co_text);</span><br><span class="line">        o3Text = (TextView)findViewById(R.id.o3_text);</span><br><span class="line">        pm10Text = (TextView)findViewById(R.id.pm10_text);</span><br><span class="line">        so2Text = (TextView)findViewById(R.id.so2_text);</span><br><span class="line"></span><br><span class="line">        // weather_suggestion</span><br><span class="line">        comfortText = (TextView)findViewById(R.id.comfort_text);</span><br><span class="line">        carWashText = (TextView)findViewById(R.id.car_wash_text);</span><br><span class="line">        sportText = (TextView)findViewById(R.id.sport_text);</span><br><span class="line">        uvText = (TextView)findViewById(R.id.uv_text);</span><br><span class="line">        clothesText = (TextView)findViewById(R.id.clothes_text);</span><br><span class="line">        coldText = (TextView)findViewById(R.id.cold_text);</span><br><span class="line">        comfortBtn = (Button)findViewById(R.id.comfort_button);</span><br><span class="line">        carWashBtn = (Button)findViewById(R.id.car_wash_button);</span><br><span class="line">        sportBtn = (Button)findViewById(R.id.sport_button);</span><br><span class="line">        uvBtn = (Button)findViewById(R.id.uv_button);</span><br><span class="line">        clothesBtn = (Button)findViewById(R.id.clothes_button);</span><br><span class="line">        coldBtn = (Button)findViewById(R.id.cold_button);</span><br><span class="line"></span><br><span class="line">        // LBS</span><br><span class="line">        mlocationClient = new LocationClient(getApplicationContext());</span><br><span class="line">        mlocationClient.registerLocationListener(new MyLocationListener());</span><br><span class="line">        List&lt;String&gt; permissionList  = new ArrayList&lt;&gt;();</span><br><span class="line">        if (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED)&#123;</span><br><span class="line">            permissionList.add(Manifest.permission.ACCESS_FINE_LOCATION);</span><br><span class="line">        &#125;</span><br><span class="line">        if (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.READ_PHONE_STATE) != PackageManager.PERMISSION_GRANTED)&#123;</span><br><span class="line">            permissionList.add(Manifest.permission.READ_PHONE_STATE);</span><br><span class="line">        &#125;</span><br><span class="line">        if (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)&#123;</span><br><span class="line">            permissionList.add(Manifest.permission.WRITE_EXTERNAL_STORAGE);</span><br><span class="line">        &#125;</span><br><span class="line">        if (!permissionList.isEmpty())&#123;</span><br><span class="line">            String[] permissions = permissionList.toArray(new String[permissionList.size()]);</span><br><span class="line">            ActivityCompat.requestPermissions(MainActivity.this, permissions, 1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        swipeRefresh = (SwipeRefreshLayout)findViewById(R.id.swipe_refresh);</span><br><span class="line">        swipeRefresh.setColorSchemeColors(getResources().getColor(R.color.colorAccent));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在 initView 中初始化控件，为了方便起见，我们在这里进行运行时权限处理，先将 List<String> 将没有获得授权的权限进行添加，然后集中申请</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 权限申请处理</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void onRequestPermissionsResult(int requestCode,  String[] permissions,  int[] grantResults) &#123;</span><br><span class="line">        switch (requestCode)&#123;</span><br><span class="line">            case 1:</span><br><span class="line">                if (grantResults.length &gt; 0)&#123;</span><br><span class="line">                    for (int result:grantResults)&#123;</span><br><span class="line">                        if (result != PackageManager.PERMISSION_GRANTED)&#123;</span><br><span class="line">                            // 如果存在某个权限没有处理</span><br><span class="line">                            finish();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    // 发生未知错误</span><br><span class="line">                    showShort(&quot;权限申请出现位置错误&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在 onRequestPermissionsResult（） 方法，如果存在权限未被允许，则直接退出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public void initListener() &#123;</span><br><span class="line">    comfortBtn.setOnClickListener(this);</span><br><span class="line">    carWashBtn.setOnClickListener(this);</span><br><span class="line">    sportBtn.setOnClickListener(this);</span><br><span class="line">    uvBtn.setOnClickListener(this);</span><br><span class="line">    clothesBtn.setOnClickListener(this);</span><br><span class="line">    coldBtn.setOnClickListener(this);</span><br><span class="line"></span><br><span class="line">    swipeRefresh.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onRefresh() &#123;</span><br><span class="line">            if (getNetworkInfo() == null)&#123;</span><br><span class="line">                Snackbar.make(swipeRefresh, &quot;当前无网络，无法刷新 %&gt;_&lt;% &quot;,Snackbar.LENGTH_LONG).setAction(&quot;去设置网络&quot;, new View.OnClickListener() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void onClick(View v) &#123;</span><br><span class="line">                        Intent intent = new Intent(Settings.ACTION_SETTINGS);</span><br><span class="line">                        startActivity(intent);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).show();</span><br><span class="line">                swipeRefresh.setRefreshing(false);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                showAnimationAlpha(weaherNowLayout);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 initListener（）方法中，对 Suggestion 部分的按钮设置监听器，同时对刷新进行监听，如果有网络的话，则执行 showAnimationAlpha（weaherNowLayout）方法，否则，显示一个可交互通知，点击通知上面的按钮，可以跳转到设置界面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private void showAnimationAlpha(final View view)&#123;</span><br><span class="line">    Animation alpha = AnimationUtils.loadAnimation(MainActivity.this,R.anim.alpha_before);</span><br><span class="line">    view.startAnimation(alpha);</span><br><span class="line">    alpha.setAnimationListener(new Animation.AnimationListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onAnimationStart(Animation animation) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onAnimationEnd(Animation animation) &#123;</span><br><span class="line">            SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(MainActivity.this);</span><br><span class="line">            String cityName = prefs.getString(&quot;cityName&quot;, null);</span><br><span class="line">            requestWeather(cityName);</span><br><span class="line">            Animation alpha = AnimationUtils.loadAnimation(MainActivity.this,R.anim.alpha_after);</span><br><span class="line">            view.startAnimation(alpha);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onAnimationRepeat(Animation animation) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 showAnimationAlpha（）方法中，我设置了一个透明度动画，同时进行监听，如果动画结束（也就是此时完全透明的时候），执行 requestWeather（）方法，对数据进行更新，之后便开启一个透明度由 0 到 1 的动画</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public void initData() &#123;</span><br><span class="line">        String cityName = getIntent().getStringExtra(&quot;cityName&quot;);</span><br><span class="line">        if (!TextUtils.isEmpty(cityName))&#123;</span><br><span class="line">            requestWeather(cityName);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);</span><br><span class="line">            String weatherString = prefs.getString(&quot;weatherResponse&quot;, null);        // weather 保存API 返回的字符串</span><br><span class="line">            if (weatherString != null)&#123;</span><br><span class="line">                // 有缓存时直接解析天气数据</span><br><span class="line">                Weather weather = Utility.handleWeatherResponse(weatherString);</span><br><span class="line">                showWeatherInfo(weather);</span><br><span class="line">                coordinatorLayout.setVisibility(View.VISIBLE);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                // 无缓存时向服务器查询数据</span><br><span class="line">                if (getNetworkInfo() != null &amp;&amp; getNetworkInfo().isAvailable())&#123;</span><br><span class="line">                    // 查询完之后显示 coordinatorLayout.setVisibility(View.VISIBLE);</span><br><span class="line">                    LocationClientOption option = new LocationClientOption();</span><br><span class="line">                    option.setIsNeedAddress(true);</span><br><span class="line">                    mlocationClient.setLocOption(option);</span><br><span class="line">                    mlocationClient.start();</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    showDialog();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            Intent intent = new Intent(MainActivity.this, AutoUpdateService.class);</span><br><span class="line">            startService(intent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在 initData（）方法执行一开始流程图的逻辑，在 else 分支中查看是否存在 weatherResponse ，如果有则直接进行加载，如果没有则通过getNetworkInfo（）方法的结果来判断是否存在网络，如果当前有网路可用则调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LocationClientOption option = new LocationClientOption();</span><br><span class="line">option.setIsNeedAddress(true);				// 获得详细地址</span><br><span class="line">mlocationClient.setLocOption(option);</span><br><span class="line">mlocationClient.start();		</span><br></pre></td></tr></table></figure>
<p>调用 mlocationClient.start() 方法后，会跳转到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class MyLocationListener implements BDLocationListener&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onReceiveLocation(BDLocation bdLocation) &#123;</span><br><span class="line">        currentPosition = bdLocation.getCity();</span><br><span class="line">        requestWeather(currentPosition);</span><br><span class="line">        showShort(currentPosition + &quot; 定位成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onConnectHotSpotMessage(String s, int i) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>则直接通过自动定位得到的城市名称来调用 requestWeather（）方法，同时显示定位成功</p>
<p>如果当前没有网路，则调用 <code>showDialog()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public void showDialog()&#123;</span><br><span class="line">    AlertDialog.Builder alertDialog  = new AlertDialog.Builder(MainActivity.this);</span><br><span class="line">    alertDialog.setMessage(&quot;当前无网络,请先打开网络&quot;);</span><br><span class="line">    alertDialog.setCancelable(false);</span><br><span class="line">    alertDialog.setPositiveButton(&quot;确定&quot;, new DialogInterface.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(DialogInterface dialog, int which) &#123;</span><br><span class="line">            Intent intent = new Intent(Settings.ACTION_SETTINGS);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">            TaskKiller.dropAllAcitivty();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    alertDialog.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显示对话框，显示当前无网路，点击确定后，直接退出所有的 Activity</p>
<p>接下来就是程序的主要函数部分了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public void requestWeather(final String cityName)&#123;</span><br><span class="line"></span><br><span class="line">        String address = &quot;https://api.heweather.com/v5/weather?city=&quot; + cityName + &quot;&amp;key=bc0418b57b2d4918819d3974ac1285d9&quot;;</span><br><span class="line">        HttpUtil.sendOkHttpRequest(address, new Callback() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Call call, IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                runOnUiThread(new Runnable() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void run() &#123;</span><br><span class="line">                        showShort(&quot;获取天气信息1失败&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(Call call, Response response) throws IOException &#123;</span><br><span class="line">                final String responseText = response.body().string();</span><br><span class="line">                final Weather weather = Utility.handleWeatherResponse(responseText);</span><br><span class="line">                runOnUiThread(new Runnable() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void run() &#123;</span><br><span class="line">                        if (weather != null &amp;&amp; &quot;ok&quot;.equals(weather.status))&#123;</span><br><span class="line">                            SharedPreferences.Editor editor = PreferenceManager.getDefaultSharedPreferences(MainActivity.this).edit();</span><br><span class="line">                            editor.putString(&quot;weatherResponse&quot;, responseText);</span><br><span class="line">                            editor.putString(&quot;cityName&quot;,cityName);</span><br><span class="line">                            editor.apply();</span><br><span class="line">                            showWeatherInfo(weather);</span><br><span class="line">                        &#125;else&#123;</span><br><span class="line">                            showShort(&quot;获取天气信息2失败&quot;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        swipeRefresh.setRefreshing(false);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在 requestWeather（）方法中，通过城市名来向接口请求数据，如果请求成功，在onResponse（）方法中将相应的数据（weatherResponse，cityName）覆盖之前的 SharedPreferences文件，然后调用 showWeatherInfo（）方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">private void showWeatherInfo(Weather weather)&#123;</span><br><span class="line"></span><br><span class="line">        String cityName = weather.basic.cityName;</span><br><span class="line">        String degree = weather.now.temperature ;</span><br><span class="line">        String weatherInfo = weather.now.more.info;</span><br><span class="line">        String updateTime = weather.basic.update.loc;</span><br><span class="line"></span><br><span class="line">        titleCity.setText(cityName);</span><br><span class="line">        degreeText.setText(degree);</span><br><span class="line">        weatherInfoText.setText(weatherInfo);</span><br><span class="line">        updateTimeText.setText(&quot;数据更新时间: &quot; + updateTime.split(&quot; &quot;)[1]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        forecastLayout.removeAllViews();</span><br><span class="line">        for (Forecast forecast : weather.forecastList)&#123;</span><br><span class="line">            // 将未来几天的天气添加到视图中</span><br><span class="line">            View view = LayoutInflater.from(MainActivity.this).inflate(R.layout.weather_forecast_item, forecastLayout, false);</span><br><span class="line">            TextView dateText = (TextView)view.findViewById(R.id.data_text);</span><br><span class="line">            TextView infoText = (TextView)view.findViewById(R.id.info_text);</span><br><span class="line">            TextView maxMinText = (TextView)view.findViewById(R.id.max_min_text);</span><br><span class="line">            ImageView weatherPic = (ImageView)view.findViewById(R.id.weather_pic);</span><br><span class="line"></span><br><span class="line">            // 动态获取 资源id</span><br><span class="line">            String weatherCode = &quot;weather_&quot;+forecast.more.code;</span><br><span class="line">            int resId = getResources().getIdentifier(weatherCode, &quot;drawable&quot;, this.getPackageName());</span><br><span class="line">            if (resId != 0)&#123;</span><br><span class="line">                weatherPic.setImageResource(resId);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            dateText.setText(Time.parseTime(forecast.date));</span><br><span class="line">            infoText.setText(forecast.more.info);</span><br><span class="line">            maxMinText.setText(forecast.temperature.max + &quot; ～ &quot; + forecast.temperature.min);</span><br><span class="line">            forecastLayout.addView(view);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hourList.clear();</span><br><span class="line">        for (Hourly hourly:weather.hourlyList)&#123;</span><br><span class="line">            Hour hour = new Hour();</span><br><span class="line">            hour.setDegree(hourly.tmp + &quot;°&quot; );</span><br><span class="line">            hour.setText(hourly.cond.txt);</span><br><span class="line">            hour.setTime(hourly.date.split(&quot; &quot;)[1]);</span><br><span class="line">            hourList.add(hour);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hourAdapter.notifyDataSetChanged();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // weather_aqi 空气质量</span><br><span class="line">        &#123;</span><br><span class="line">            String infoText = &quot;无&quot;;</span><br><span class="line">            if (weather.aqi.city.aqi != null)&#123;</span><br><span class="line">                aqiText.setText(weather.aqi.city.aqi);</span><br><span class="line">                aqiText.getPaint().setFakeBoldText(true);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                aqiText.setText(infoText);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (weather.aqi.city.pm25 != null)&#123;</span><br><span class="line">                pm25Text.setText(weather.aqi.city.pm25);</span><br><span class="line">                pm25Text.getPaint().setFakeBoldText(true);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                pm25Text.setText(infoText);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (weather.aqi.city.co != null)&#123;</span><br><span class="line">                coText.setText(weather.aqi.city.co);</span><br><span class="line">                coText.getPaint().setFakeBoldText(true);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                coText.setText(infoText);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (weather.aqi.city.o3 != null)&#123;</span><br><span class="line">                o3Text.setText(weather.aqi.city.o3);</span><br><span class="line">                o3Text.getPaint().setFakeBoldText(true);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                o3Text.setText(infoText);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (weather.aqi.city.pm10 != null)&#123;</span><br><span class="line">                pm10Text.setText(weather.aqi.city.pm10);</span><br><span class="line">                pm10Text.getPaint().setFakeBoldText(true);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                pm10Text.setText(infoText);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (weather.aqi.city.so2 != null)&#123;</span><br><span class="line">                so2Text.setText(weather.aqi.city.so2);</span><br><span class="line">                so2Text.getPaint().setFakeBoldText(true);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                so2Text.setText(infoText);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        comfortSign = weather.suggestion.comfort.sign;</span><br><span class="line">        carWashSign = weather.suggestion.carWash.sign;</span><br><span class="line">        sportSign = weather.suggestion.sport.sign;</span><br><span class="line">        uvSign = weather.suggestion.uv.sign;</span><br><span class="line">        clothesSign = weather.suggestion.clothes.sign;</span><br><span class="line">        coldSign = weather.suggestion.cold.sign;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        comfortText.setText(comfortSign);</span><br><span class="line">        comfortText.getPaint().setFakeBoldText(true);</span><br><span class="line">        carWashText.setText(carWashSign);</span><br><span class="line">        carWashText.getPaint().setFakeBoldText(true);</span><br><span class="line">        sportText.setText(sportSign);</span><br><span class="line">        sportText.getPaint().setFakeBoldText(true);</span><br><span class="line">        uvText.setText(uvSign);</span><br><span class="line">        uvText.getPaint().setFakeBoldText(true);</span><br><span class="line">        clothesText.setText(clothesSign);</span><br><span class="line">        clothesText.getPaint().setFakeBoldText(true);</span><br><span class="line">        coldText.setText(coldSign);</span><br><span class="line">        coldText.getPaint().setFakeBoldText(true);</span><br><span class="line"></span><br><span class="line">        comfortInfo = weather.suggestion.comfort.info;</span><br><span class="line">        carWashInfo = weather.suggestion.carWash.info;</span><br><span class="line">        sportInfo = weather.suggestion.sport.info;</span><br><span class="line">        uvInfo = weather.suggestion.uv.info;</span><br><span class="line">        clothesInfo = weather.suggestion.clothes.info;</span><br><span class="line">        coldInfo = weather.suggestion.cold.info;</span><br><span class="line"></span><br><span class="line">        weatherLayout.setVisibility(View.VISIBLE);</span><br><span class="line">        coordinatorLayout.setVisibility(View.VISIBLE);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在 showWeatherInfo（） 方法中进行的操作基本就是将通过得到的 Weather 对象中获取数据，然后将数值赋值到控件上，因为在 Hourly 中，我们采用的是 RecyclerView，所以需要使用 notifyDataSetChanged（） 方法让适配器更新数据。在最后的部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">weatherLayout.setVisibility(View.VISIBLE);</span><br><span class="line">coordinatorLayout.setVisibility(View.VISIBLE);</span><br></pre></td></tr></table></figure>
<p>将界面设置为可见</p>
<p>需要注意的一部分代码是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String weatherCode = &quot;weather_&quot;+forecast.more.code;</span><br><span class="line">int resId = getResources().getIdentifier(weatherCode, &quot;drawable&quot;, this.getPackageName());</span><br><span class="line">if (resId != 0)&#123;</span><br><span class="line">       weatherPic.setImageResource(resId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为返回的数据中包含天气码，每个天气码都有一个对应的天气图片与之对应，但是我们总不能对几十个天气图片进行 if 判定，所以我们可以通过 getIdentifier（） 方法动态的匹配资源 ID， 第一个参数为资源ID 的String 格式，第二个为资源所在的文件夹，第三个一般情况下是包名</p>
<p>另外，我们在 <code>dateText.setText(Time.parseTime(forecast.date));</code>中，这里用到了一个 Time.parseTime() 的函数对解析得到的天气数据进行二次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">public class Time &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 输入时间 XXXX-XX-XX 的字符串, 放回中文指代的时间, 比如 &quot;今天 02/09&quot;</span><br><span class="line">     */</span><br><span class="line">    public static String parseTime(String timeText)&#123;</span><br><span class="line">        DateTime dateTime = new DateTime();</span><br><span class="line">        String[] time = timeText.split(&quot;-&quot;);</span><br><span class="line"></span><br><span class="line">        int currentMonth = dateTime.getMonthOfYear();</span><br><span class="line">        int currentDay = dateTime.getDayOfMonth();</span><br><span class="line">        int currentWeak = dateTime.getDayOfWeek();</span><br><span class="line">        int currentYear = dateTime.getYear();</span><br><span class="line"></span><br><span class="line">        int month = Integer.parseInt(time[1]);</span><br><span class="line">        int day = Integer.parseInt(time[2]);</span><br><span class="line">        int year = Integer.parseInt(time[0]);</span><br><span class="line"></span><br><span class="line">        int offset = 0;  // 相差量</span><br><span class="line"></span><br><span class="line">        if (year == currentYear)&#123;</span><br><span class="line">            //如果是同一年：</span><br><span class="line">            if (month == currentMonth)&#123;</span><br><span class="line">                // 如果是同一个月</span><br><span class="line">                offset = day - currentDay;</span><br><span class="line"></span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                offset = day + parseMonth(currentMonth, currentYear) - currentDay;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            offset = 31 - currentDay + day;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String monthAndDay = time[1] + &quot;/&quot; + time[2];</span><br><span class="line">        if (offset == 0) return &quot;今天 &quot; + monthAndDay;</span><br><span class="line">        if (offset == 1) return  &quot;明天 &quot; + monthAndDay;</span><br><span class="line">        return parseWeak(currentWeak + offset) + &quot; &quot; + monthAndDay;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 输入一个数字, 输出是星期几的字符串: 2  -&gt;  周二</span><br><span class="line">     */</span><br><span class="line">    public static String parseWeak(int weak)&#123;</span><br><span class="line">        String[] weakday = new String[]&#123;&quot;周一&quot;, &quot;周二&quot;, &quot;周三&quot;, &quot;周四&quot;, &quot;周五&quot;, &quot;周六&quot;, &quot;周日&quot;&#125;;</span><br><span class="line">        int index = (weak - 1)%7;</span><br><span class="line">        return weakday[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 输入月份和年份, 输出该月份的天数</span><br><span class="line">     */</span><br><span class="line">    public static int parseMonth(int month, int year)&#123;</span><br><span class="line">        switch (month)&#123;</span><br><span class="line">            case 1:</span><br><span class="line">            case 3:</span><br><span class="line">            case 5:</span><br><span class="line">            case 7:</span><br><span class="line">            case 8:</span><br><span class="line">            case 10:</span><br><span class="line">            case 12:return 31;</span><br><span class="line">            case 2:</span><br><span class="line">                if (parseYear(year)) &#123;</span><br><span class="line">                    return 29;</span><br><span class="line">                &#125;</span><br><span class="line">                return 28;</span><br><span class="line">            default:</span><br><span class="line">                return 30;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 输入年份, 判断是否是闰年</span><br><span class="line">     */</span><br><span class="line">    public static boolean parseYear(int year)&#123;</span><br><span class="line">        String yearOfString = String.valueOf(year);</span><br><span class="line">        int len = yearOfString.length();</span><br><span class="line">        char lastOne = yearOfString.charAt(len - 1);</span><br><span class="line">        char lastTwo = yearOfString.charAt(len - 2);</span><br><span class="line">        if (lastOne == lastTwo &amp;&amp; lastOne == &#x27;0&#x27;)&#123;</span><br><span class="line">            if (year % 400 == 0)&#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (year % 4 == 0)&#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个类的作用主要是对天气数据进行处理，以此得到更加人性化的设计：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 今天是 2017/5/16</span><br><span class="line"></span><br><span class="line">2017/5/16   -&gt;   今天</span><br><span class="line">2017/5/17   -&gt;   明天</span><br><span class="line">2017/5/18   -&gt;   周四 5/18</span><br><span class="line">2017/5/19   -&gt;   周五 5/19</span><br></pre></td></tr></table></figure>
<p>大概就是这样的作用，没什么好介绍的，不过这个类的作用是两天的间隔相差在一个月之内（毕竟….天气预报）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onClick(View v) &#123;</span><br><span class="line">    // 通过 SuggestionInfoActivity 中的静态方法直接传值</span><br><span class="line">    switch (v.getId())&#123;</span><br><span class="line">        case R.id.comfort_button:</span><br><span class="line">            SuggestionInfoActivity.actionStart(this, comfortInfo,comfortSign,&quot;舒适度指数&quot;);</span><br><span class="line">            break;</span><br><span class="line">        case R.id.car_wash_button:</span><br><span class="line">            SuggestionInfoActivity.actionStart(this, carWashInfo,carWashSign,&quot;洗车指数&quot;);</span><br><span class="line">            break;</span><br><span class="line">        case R.id.sport_button:</span><br><span class="line">            SuggestionInfoActivity.actionStart(this, sportInfo,sportSign,&quot;运动指数&quot;);</span><br><span class="line">            break;</span><br><span class="line">        case R.id.cold_button:</span><br><span class="line">            SuggestionInfoActivity.actionStart(this, coldInfo,coldSign,&quot;感冒指数&quot;);</span><br><span class="line">            break;</span><br><span class="line">        case R.id.clothes_button:</span><br><span class="line">            SuggestionInfoActivity.actionStart(this, clothesInfo,clothesSign,&quot;穿衣指数&quot;);</span><br><span class="line">            break;</span><br><span class="line">        case R.id.uv_button:</span><br><span class="line">            SuggestionInfoActivity.actionStart(this, uvInfo,uvSign,&quot;紫外线指数&quot;);</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 Suuggestion部分的button 点击事件中，调用了SuggestionInfoActivity 的静态方法 actionStart( )，并且传入对应的四个参数 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onDestroy() &#123;</span><br><span class="line">    super.onDestroy();</span><br><span class="line">    mlocationClient.stop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 onDestor( )方法中停止 mlocationClient，毕竟，不能总在定位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static void actionStart(Context context ,String cityName)&#123;</span><br><span class="line">    Intent intent = new Intent(context, MainActivity.class);</span><br><span class="line">    intent.putExtra(&quot;cityName&quot;, cityName);</span><br><span class="line">    context.startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是 MainActivity 中的跳转静态函数，用来在选择地区时跳转，传入选择的地区名称</p>
<p>activity_suggestion_info</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:background=&quot;@color/colorBackground&quot;</span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.Toolbar</span><br><span class="line">        android:id=&quot;@+id/toolbar_suggestion_info&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;?attr/actionBarSize&quot;</span><br><span class="line">        android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:titleTextColor=&quot;@color/colorFont&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.CardView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;250dp&quot;</span><br><span class="line">        android:layout_marginTop=&quot;15dp&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">        android:layout_marginRight=&quot;10dp&quot;</span><br><span class="line">        app:cardElevation=&quot;2dp&quot;</span><br><span class="line">        app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">        &gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/suggestion_title&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">                android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">                android:textSize=&quot;24sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorRed&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=&quot;@+id/suggestion_text&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">                android:layout_marginLeft=&quot;10dp&quot;</span><br><span class="line">                android:textSize=&quot;14sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>布局很简单， CardView 上有两个 TextView 控件</p>
<p>SuggestionInfoActivity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">public class SuggestionInfoActivity extends BaseActivity &#123;</span><br><span class="line"></span><br><span class="line">    private TextView suggestText;</span><br><span class="line">    private TextView suggestTitle;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private String info;</span><br><span class="line">    private String sign;</span><br><span class="line">    private String source;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initView() &#123;</span><br><span class="line">        setContentView(R.layout.activity_suggestion_info);</span><br><span class="line"></span><br><span class="line">        Toolbar toolbar = (Toolbar)findViewById(R.id.toolbar_suggestion_info);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        ActionBar actionBar = getSupportActionBar();</span><br><span class="line">        if (actionBar != null)&#123;</span><br><span class="line">            actionBar.setDisplayHomeAsUpEnabled(true);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        suggestText = (TextView)findViewById(R.id.suggestion_text);</span><br><span class="line">        suggestTitle = (TextView)findViewById(R.id.suggestion_title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initListener() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initData() &#123;</span><br><span class="line">        info = getIntent().getStringExtra(&quot;info&quot;);</span><br><span class="line">        sign = getIntent().getStringExtra(&quot;sign&quot;);</span><br><span class="line">        source = getIntent().getStringExtra(&quot;source&quot;);</span><br><span class="line"></span><br><span class="line">        getSupportActionBar().setTitle(source);</span><br><span class="line">        suggestTitle.setText(sign);</span><br><span class="line">        suggestTitle.getPaint().setFakeBoldText(true);</span><br><span class="line">        suggestText.setText(info);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onOptionsItemSelected(MenuItem item) &#123;</span><br><span class="line">        switch (item.getItemId())&#123;</span><br><span class="line">            case android.R.id.home:</span><br><span class="line">                finish();</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void actionStart(Context context, String info, String sign, String source)&#123;</span><br><span class="line">        Intent intent = new Intent(context, SuggestionInfoActivity.class);</span><br><span class="line">        intent.putExtra(&quot;info&quot;, info);</span><br><span class="line">        intent.putExtra(&quot;sign&quot;, sign);</span><br><span class="line">        intent.putExtra(&quot;source&quot;, source);</span><br><span class="line">        context.startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SuggestionInfoActivity 中的静态函数 actionStart( ) 传入四个参数，其他 Activity 来调用这个静态函数可以实现更加方便的跳转，而在 SuggestionInfoActivity 也可以更加方便处理传过来的参数，将传入的参数显示在控件上</p>
<p>新建 menu文件夹，新建文件 menu.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;item</span><br><span class="line">        android:id=&quot;@+id/setting&quot;</span><br><span class="line">        android:title=&quot;设置&quot;</span><br><span class="line">        app:showAsAction=&quot;never&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;item</span><br><span class="line">        android:id=&quot;@+id/night_model&quot;</span><br><span class="line">        android:title=&quot;夜间模式&quot;</span><br><span class="line">        app:showAsAction=&quot;never&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/menu&gt;</span><br></pre></td></tr></table></figure>
<p>两个菜单项 “设置”，“夜间模式”</p>
<p>在 MainActivity 中添加如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * 添加 actionbar 菜单项</span><br><span class="line">    */</span><br><span class="line">   @Override</span><br><span class="line">   public boolean onCreateOptionsMenu(Menu menu) &#123;</span><br><span class="line">       getMenuInflater().inflate(R.menu.menu, menu);</span><br><span class="line">       return true;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * 菜单点击事件响应</span><br><span class="line">    */</span><br><span class="line">   @Override</span><br><span class="line">   public boolean onOptionsItemSelected(MenuItem item) &#123;</span><br><span class="line">       switch (item.getItemId())&#123;</span><br><span class="line">           case R.id.setting:</span><br><span class="line">               // 跳转到设置界面</span><br><span class="line">               Intent intent1 = new Intent(this, SettingActivity.class);</span><br><span class="line">               intent1.putExtra(&quot;weather_title&quot;,&quot;设置&quot;);</span><br><span class="line">               startActivity(intent1);</span><br><span class="line">               break;</span><br><span class="line">           case R.id.night_model:</span><br><span class="line">               SharedPreferences pref = PreferenceManager.getDefaultSharedPreferences(this);</span><br><span class="line">               SharedPreferences.Editor editor = pref.edit();</span><br><span class="line">               boolean isNight = pref.getBoolean(&quot;isNight&quot;, false);</span><br><span class="line">               if (isNight)&#123;</span><br><span class="line">                   // 如果已经是夜间模式</span><br><span class="line">                   getDelegate().setLocalNightMode(AppCompatDelegate.MODE_NIGHT_NO);</span><br><span class="line">                   recreate();</span><br><span class="line">                   editor.putBoolean(&quot;isNight&quot;, false);</span><br><span class="line">                   editor.apply();</span><br><span class="line">               &#125;else&#123;</span><br><span class="line">                   // 如果是日间模式</span><br><span class="line">                   getDelegate().setLocalNightMode(AppCompatDelegate.MODE_NIGHT_YES);</span><br><span class="line">                   recreate();</span><br><span class="line">                   editor.putBoolean(&quot;isNight&quot;, true);</span><br><span class="line">                   editor.apply();</span><br><span class="line">               &#125;</span><br><span class="line">               break;</span><br><span class="line">       &#125;</span><br><span class="line">       return true;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>我们先忽略 night_model 的点击事件，当点击 setting 按钮，跳转到设置界面 activity_setting</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:background=&quot;@color/colorBackground&quot;</span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.Toolbar</span><br><span class="line">        android:id=&quot;@+id/toolbar_setting&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;?attr/actionBarSize&quot;</span><br><span class="line">        android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:titleTextColor=&quot;@color/colorFont&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_margin=&quot;15dp&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;</span><br><span class="line">        android:background=&quot;@color/colorBackground&quot;</span><br><span class="line">        &gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/choose_area&quot;</span><br><span class="line">                android:text=&quot;选择地区&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/auto_update_time&quot;</span><br><span class="line">                android:text=&quot;更新频率&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/about_app&quot;</span><br><span class="line">                android:text=&quot;关于天气&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>布局中存在三个按钮，选择地区，更新频率，关于天气</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">public class SettingActivity extends BaseActivity&#123;</span><br><span class="line"></span><br><span class="line">    private Button chooseArea;</span><br><span class="line">    private Button aboutApplication;</span><br><span class="line">    private Button autoUpdateTime;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initView() &#123;</span><br><span class="line">        setContentView(R.layout.activity_setting);</span><br><span class="line"></span><br><span class="line">        Toolbar toolbar = (Toolbar)findViewById(R.id.toolbar_setting);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        ActionBar actionBar = getSupportActionBar();</span><br><span class="line">        if (actionBar != null)&#123;</span><br><span class="line">            actionBar.setDisplayHomeAsUpEnabled(true);</span><br><span class="line">            actionBar.setTitle(&quot;设置&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        chooseArea = (Button)findViewById(R.id.choose_area);</span><br><span class="line">        aboutApplication = (Button)findViewById(R.id.about_app);</span><br><span class="line">        autoUpdateTime = (Button)findViewById(R.id.auto_update_time);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initListener() &#123;</span><br><span class="line">        chooseArea.setOnClickListener(this);</span><br><span class="line">        aboutApplication.setOnClickListener(this);</span><br><span class="line">        autoUpdateTime.setOnClickListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initData() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onOptionsItemSelected(MenuItem item) &#123;</span><br><span class="line">        switch (item.getItemId())&#123;</span><br><span class="line">            case android.R.id.home:</span><br><span class="line">                finish();</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        switch (v.getId())&#123;</span><br><span class="line">            case R.id.choose_area:</span><br><span class="line">                // 跳转到选择地区界面</span><br><span class="line">                actionStart(ChooseAreaActivity.class);</span><br><span class="line">                break;</span><br><span class="line">            case R.id.about_app:</span><br><span class="line">                // 跳转到关于天气界面</span><br><span class="line">                actionStart(AboutApplicationActivity.class);</span><br><span class="line">                break;</span><br><span class="line">            case R.id.auto_update_time:</span><br><span class="line">                //跳转到自动更新频率界面</span><br><span class="line">                actionStart(AutoUpdateTimeAcitivity.class);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void actionStart(Class&lt;?&gt; c)&#123;</span><br><span class="line">        Intent intent = new Intent(this, c);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击不同按钮进行界面跳转时会调用 actionStart( )函数，参数之后一个类名，作用是从当前 Activity 跳转到其他的 Activity </p>
<p>当点击 第一个按钮 choose_area，跳转到选择地区界面，activity_choose_area：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:background=&quot;@color/colorBackground&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.Toolbar</span><br><span class="line">        android:id=&quot;@+id/tool_bar&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;?attr/actionBarSize&quot;</span><br><span class="line">        android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:titleTextColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.CardView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;180dp&quot;</span><br><span class="line">        android:layout_margin=&quot;20dp&quot;</span><br><span class="line">        android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:cardBackgroundColor=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:cardElevation=&quot;2dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;20dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;LinearLayout</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:background=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;EditText</span><br><span class="line">                    android:id=&quot;@+id/search_text&quot;</span><br><span class="line">                    android:layout_width=&quot;0dp&quot;</span><br><span class="line">                    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                    android:layout_weight=&quot;1&quot;</span><br><span class="line">                    android:textSize=&quot;16sp&quot;</span><br><span class="line">                    android:hint=&quot;查找的城市&quot;</span><br><span class="line">                    android:textColorHint=&quot;@color/colorFont&quot;</span><br><span class="line">                    android:textColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line">                &lt;Button</span><br><span class="line">                    android:id=&quot;@+id/search_button&quot;</span><br><span class="line">                    android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                    android:text=&quot;搜索&quot;</span><br><span class="line">                    android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                    style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                    android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ListView</span><br><span class="line">                android:id=&quot;@+id/list_view&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                android:scrollbars=&quot;none&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.CardView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;300dp&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;20dp&quot;</span><br><span class="line">        android:layout_marginRight=&quot;20dp&quot;</span><br><span class="line">        android:layout_marginTop=&quot;5dp&quot;</span><br><span class="line">        app:cardBackgroundColor=&quot;@color/colorWhite&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;20dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:text=&quot;查找记录&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ListView</span><br><span class="line">                android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">                android:id=&quot;@+id/list_view_recond&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                android:scrollbars=&quot;none&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>存在两个卡片布局，上一个卡片布局中包含三个控件，EditText，Button，ListView。其中 EditText 用来输入搜索的城市，点击 Button 进行搜索，结果显示在 ListView 上。下一个布局包含两个控件，TextView, ListView, 其中， ListView 显示搜索记录</p>
<p>由于要显示搜索记录，自然炫耀保存数据，这里我选择 LitePal 来保存搜索记录，这里我对搜索记录的处理是这样：只有搜索之后得到结果的搜索才能保存，其他的搜索没有得到有效的数据，自然没有保存的必要。我们先建立数据库，之前在 build.gradle 中已经声明了依赖库，我们还需要在 AndroidManifest 中添加 name 属性，以便 LitePal 可以全局获取 Context</p>
<p>在包下建立一个文件夹 db ,在文件夹中新建一个文件 CityRecond 用来记录搜索记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class CityRecond  extends DataSupport&#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String cityName;</span><br><span class="line"></span><br><span class="line">    public int getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(int id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCityName() &#123;</span><br><span class="line">        return cityName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCityName(String cityName) &#123;</span><br><span class="line">        this.cityName = cityName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在 main 目录下新建文件夹 assets ，新建 litepal 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;litepal&gt;</span><br><span class="line">    &lt;dbname value=&quot;CoolWeather&quot;/&gt;</span><br><span class="line">    &lt;version value=&quot;1&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;list&gt;</span><br><span class="line">        &lt;mapping class=&quot;com.example.coolweather.db.CityRecond&quot;&gt;&lt;/mapping&gt;</span><br><span class="line">    &lt;/list&gt;</span><br><span class="line"></span><br><span class="line">&lt;/litepal&gt;</span><br></pre></td></tr></table></figure>

<p>这样， 数据库基本就建立好了。 因为我们在搜索界面只需要检索城市信息，城市请求URL为：</p>
<center>![这里写图片描述](http://img.blog.csdn.net/20170516202609636?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWl3ZWkxMg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

<center>![这里写图片描述](http://img.blog.csdn.net/20170516202642464?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWl3ZWkxMg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

<p>在 gson 目录下创建对应的实体类：</p>
<p>City.class</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class City &#123;</span><br><span class="line"></span><br><span class="line">    public Basic basic;</span><br><span class="line"></span><br><span class="line">    public String status;</span><br><span class="line"></span><br><span class="line">    public class Basic&#123;</span><br><span class="line">        public String city;</span><br><span class="line">        public String cnty;</span><br><span class="line">        public String lat;</span><br><span class="line">        public String lon;</span><br><span class="line">        public String prov;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 Utility 类中添加方法 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static City handleCityResponse(String response)&#123;</span><br><span class="line">       try&#123;</span><br><span class="line">           JSONObject jsonObject = new JSONObject(response);</span><br><span class="line">           JSONArray jsonArray = jsonObject.getJSONArray(&quot;HeWeather5&quot;);</span><br><span class="line">           String cityContent = jsonArray.getJSONObject(0).toString();</span><br><span class="line">           return new Gson().fromJson(cityContent, City.class);</span><br><span class="line">       &#125;catch (Exception e)&#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       return null;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>直接转化为 City 类</p>
<p>回到 ChooaseAreaActivity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">public class ChooseAreaActivity extends BaseActivity &#123;</span><br><span class="line">    private EditText searchText;</span><br><span class="line">    private Button searchButton;</span><br><span class="line">    private ListView listView;</span><br><span class="line">    private ListView listViewRecond;</span><br><span class="line">    private List&lt;String&gt; cityList = new ArrayList&lt;&gt;();</span><br><span class="line">    private List&lt;String&gt; recondList = new ArrayList&lt;&gt;();</span><br><span class="line">    ArrayAdapter&lt;String&gt; adapter;</span><br><span class="line">    ArrayAdapter&lt;String&gt; recondAdapter;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initView() &#123;</span><br><span class="line">        setContentView(R.layout.activity_choose_area);</span><br><span class="line">        Toolbar toolbar = (Toolbar)findViewById(R.id.tool_bar);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        ActionBar actionBar = getSupportActionBar();</span><br><span class="line">        if (actionBar != null)&#123;</span><br><span class="line">            actionBar.setDisplayHomeAsUpEnabled(true);</span><br><span class="line">            actionBar.setTitle(&quot;选择地区&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        searchText = (EditText)findViewById(R.id.search_text);</span><br><span class="line">        searchButton = (Button)findViewById(R.id.search_button);</span><br><span class="line">        listView = (ListView)findViewById(R.id.list_view);</span><br><span class="line">        adapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, cityList);</span><br><span class="line">        listView.setAdapter(adapter);</span><br><span class="line">        listView.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123;</span><br><span class="line">                if (getNetworkInfo() != null &amp;&amp; getNetworkInfo().isAvailable())&#123;</span><br><span class="line">                    String cityName = cityList.get(position);</span><br><span class="line">                    MainActivity.actionStart(ChooseAreaActivity.this, cityName);</span><br><span class="line">                    finish();</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    showShort(&quot;当前没有网络&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        listViewRecond = (ListView)findViewById(R.id.list_view_recond);</span><br><span class="line">        recondAdapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, recondList);</span><br><span class="line">        listViewRecond.setAdapter(recondAdapter);</span><br><span class="line">        listViewRecond.setOnItemClickListener(new AdapterView.OnItemClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) &#123;</span><br><span class="line">                if (getNetworkInfo() != null &amp;&amp; getNetworkInfo().isAvailable())&#123;</span><br><span class="line">                    String cityName = recondList.get(position);</span><br><span class="line">                    MainActivity.actionStart(ChooseAreaActivity.this, cityName);</span><br><span class="line">                    finish();</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    showShort(&quot;当前没有网络&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        showRecond();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initData() &#123;</span><br><span class="line">        LitePal.getDatabase();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initListener() &#123;</span><br><span class="line">        searchButton.setOnClickListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        switch (v.getId())&#123;</span><br><span class="line">            case R.id.search_button:</span><br><span class="line">                showSearchResult();</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void showSearchResult()&#123;</span><br><span class="line">        String cityName = searchText.getText().toString();</span><br><span class="line">        if (!TextUtils.isEmpty(cityName))&#123;</span><br><span class="line">            // 如果不为空，则进行查询</span><br><span class="line">            if (getNetworkInfo() != null &amp;&amp; getNetworkInfo().isAvailable())&#123;</span><br><span class="line">                String address = &quot;https://api.heweather.com/v5/search?city=&quot; + cityName + &quot;&amp;key=bc0418b57b2d4918819d3974ac1285d9&quot;;</span><br><span class="line">                requestData(address);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                showShort(&quot;当前网络无连接&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            showShort(&quot;请输入城市名称&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void requestData(String address)&#123;</span><br><span class="line">        HttpUtil.sendOkHttpRequest(address, new Callback() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Call call, IOException e) &#123;</span><br><span class="line">                runOnUiThread(new Runnable() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void run() &#123;</span><br><span class="line">                        showShort(&quot;请求数据失败&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(Call call, Response response) throws IOException &#123;</span><br><span class="line">                String responseText = response.body().string();</span><br><span class="line">                final City city = Utility.handleCityResponse(responseText);</span><br><span class="line">                runOnUiThread(new Runnable() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    public void run() &#123;</span><br><span class="line">                        showCity(city);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void showCity(City city)&#123;</span><br><span class="line">        cityList.clear();</span><br><span class="line">        if (&quot;ok&quot;.equals(city.status) &amp;&amp; city != null)&#123;</span><br><span class="line">            cityList.add(city.basic.city);</span><br><span class="line">            solveSearchRecond(city.basic.city);</span><br><span class="line">            adapter.notifyDataSetChanged();</span><br><span class="line">            listView.setSelection(0);</span><br><span class="line"></span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            showShort(&quot;未找到该城市&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 保存城市名称 -&gt; 数据库</span><br><span class="line">     */</span><br><span class="line">    public void solveSearchRecond(String cityName)&#123;</span><br><span class="line">        CityRecond cityRecond = new CityRecond();</span><br><span class="line">        cityRecond.setCityName(cityName);</span><br><span class="line">        cityRecond.save();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onOptionsItemSelected(MenuItem item) &#123;</span><br><span class="line">        switch (item.getItemId())&#123;</span><br><span class="line">            case android.R.id.home:</span><br><span class="line">                finish();</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 显示数据库中保存的信息</span><br><span class="line">     */</span><br><span class="line">    public void showRecond()&#123;</span><br><span class="line">        recondList.clear();</span><br><span class="line">        List&lt;CityRecond&gt; list = DataSupport.select(&quot;cityName&quot;).find(CityRecond.class);</span><br><span class="line">        for (CityRecond recond:list)&#123;</span><br><span class="line">            recondList.add(recond.getCityName());</span><br><span class="line">        &#125;</span><br><span class="line">        recondAdapter.notifyDataSetChanged();</span><br><span class="line">        listViewRecond.setSelection(0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 initData( ) 方法中调用了 LitePal.getDatabase( ) 创建数据库同时创建表，当点击搜索按钮时，调用 showSearchResult( )方法，判定是否为空，如果为空，则调用showShort(“请输入城市名称”) 提醒，如果不为空，通过判定getNetworkInfo( ) 是否存在网络，如果不存在则提醒，否则执行requestData( ) 方法，如果回调成功，则调用 showCity( ) 方法，传入解析得到的 City 对象，在 showCity( ) 方法中，将数据显示在搜索结果中，同时将数据保存在数据库文件中，每次打开 ChooseAreaActivity 都会调用 showRecond( ) 方法，通过DataSupport.select( )找到所有保存的 cityName, 并且将数据显示在 ListView 中。 对两个 listView的子项都进行了监听，点击子项时，还是先判断是否存在网络，如果存在网络，则调用 MainActivity 中的静态方法，传入 cityName 参数，这就是在 MainActivity 中一开始需要判定的原因，如果是 Activity 跳转，则需要根据传入的 cityName 来进行请求，解析等一系列步骤，但是如果是从桌面打开，则可以直接通过缓存文件来解析数据</p>
<p>到这里，ChooseAreaActivity 的任务就结束了，开始看 activity_setting 界面的第二个按钮，更新频率</p>
<p>点击更新频率跳转到 activity_auto_update_time</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:background=&quot;@color/colorBackground&quot;</span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.Toolbar</span><br><span class="line">        android:id=&quot;@+id/tool_bar&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;?attr/actionBarSize&quot;</span><br><span class="line">        android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:titleTextColor=&quot;@color/colorFont&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_margin=&quot;15dp&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;</span><br><span class="line">        android:background=&quot;@color/colorBackground&quot;</span><br><span class="line">        &gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/hour1&quot;</span><br><span class="line">                android:text=&quot;1 小时&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/hour2&quot;</span><br><span class="line">                android:text=&quot;两小时&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/hour3&quot;</span><br><span class="line">                android:text=&quot;三小时&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/hour5&quot;</span><br><span class="line">                android:text=&quot;五小时&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/hour10&quot;</span><br><span class="line">                android:text=&quot;十小时&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.v7.widget.CardView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;60dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            app:cardCornerRadius=&quot;0dp&quot;</span><br><span class="line">            app:cardElevation=&quot;1dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Button</span><br><span class="line">                android:id=&quot;@+id/hour0&quot;</span><br><span class="line">                android:text=&quot;不进行自动更新&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;16sp&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;match_parent&quot;</span><br><span class="line">                style=&quot;?android:attr/borderlessButtonStyle&quot;</span><br><span class="line">                android:background=&quot;@drawable/ripple&quot;</span><br><span class="line">                /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>界面很简单，有六个按钮，来控制更新的频率和是否更新，当然这个数值还是根据 SharedPerferenced 文件来传递的</p>
<p>AutoUpdateTimeActivity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">public class AutoUpdateTimeAcitivity extends BaseActivity &#123;</span><br><span class="line">    private Button button1;</span><br><span class="line">    private Button button2;</span><br><span class="line">    private Button button3;</span><br><span class="line">    private Button button5;</span><br><span class="line">    private Button button10;</span><br><span class="line">    private Button button0;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initView() &#123;</span><br><span class="line">        setContentView(R.layout.activity_auto_update_time);</span><br><span class="line"></span><br><span class="line">        Toolbar toolbar = (Toolbar)findViewById(R.id.tool_bar);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        ActionBar actionBar = getSupportActionBar();</span><br><span class="line">        if (actionBar != null)&#123;</span><br><span class="line">            actionBar.setDisplayHomeAsUpEnabled(true);</span><br><span class="line">            actionBar.setTitle(&quot;更新频率&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        button0 = (Button)findViewById(R.id.hour0);</span><br><span class="line">        button1 =(Button)findViewById(R.id.hour1);</span><br><span class="line">        button2 = (Button)findViewById(R.id.hour2);</span><br><span class="line">        button3 = (Button)findViewById(R.id.hour3);</span><br><span class="line">        button5 = (Button)findViewById(R.id.hour5);</span><br><span class="line">        button10 = (Button)findViewById(R.id.hour10);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initData() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initListener() &#123;</span><br><span class="line">        button0.setOnClickListener(this);</span><br><span class="line">        button2.setOnClickListener(this);</span><br><span class="line">        button1.setOnClickListener(this);</span><br><span class="line">        button3.setOnClickListener(this);</span><br><span class="line">        button5.setOnClickListener(this);</span><br><span class="line">        button10.setOnClickListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        SharedPreferences.Editor editor = PreferenceManager.getDefaultSharedPreferences(this).edit();</span><br><span class="line">        switch (v.getId())&#123;</span><br><span class="line">            case R.id.hour0:</span><br><span class="line">                editor.putBoolean(&quot;isUpdateTime&quot;, false);</span><br><span class="line">                break;</span><br><span class="line">            case R.id.hour1:</span><br><span class="line">                editor.putBoolean(&quot;isUpdateTime&quot;,true);</span><br><span class="line">                editor.putInt(&quot;autoUpdateTime&quot;, 60);</span><br><span class="line">                break;</span><br><span class="line">            case R.id.hour2:</span><br><span class="line">                editor.putBoolean(&quot;isUpdateTime&quot;,true);</span><br><span class="line">                editor.putInt(&quot;autoUpdateTime&quot;, 120);</span><br><span class="line">                break;</span><br><span class="line">            case R.id.hour3:</span><br><span class="line">                editor.putBoolean(&quot;isUpdateTime&quot;,true);</span><br><span class="line">                editor.putInt(&quot;autoUpdateTime&quot;, 180);</span><br><span class="line">                break;</span><br><span class="line">            case R.id.hour5:</span><br><span class="line">                editor.putBoolean(&quot;isUpdateTime&quot;,true);</span><br><span class="line">                editor.putInt(&quot;autoUpdateTime&quot;, 300);</span><br><span class="line">                break;</span><br><span class="line">            case R.id.hour10:</span><br><span class="line">                editor.putBoolean(&quot;isUpdateTime&quot;,true);</span><br><span class="line">                editor.putInt(&quot;autoUpdateTime&quot;, 600);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        editor.apply();</span><br><span class="line">        Intent intent = new Intent(this, AutoUpdateService.class);</span><br><span class="line">        startService(intent);</span><br><span class="line">        showShort(&quot;设置成功&quot;);</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onOptionsItemSelected(MenuItem item) &#123;</span><br><span class="line">        switch (item.getItemId())&#123;</span><br><span class="line">            case android.R.id.home:</span><br><span class="line">                finish();</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以很清楚的看到代码逻辑，点击不同的按键，会修改 isUpdateTime 和 autoUpdateTime 的值，然后会启动 AutoUpdateService：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">public class AutoUpdateService extends Service &#123;</span><br><span class="line">    public AutoUpdateService() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public IBinder onBind(Intent intent) &#123;</span><br><span class="line">        // TODO: Return the communication channel to the service.</span><br><span class="line">        throw new UnsupportedOperationException(&quot;Not yet implemented&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int onStartCommand(Intent intent, int flags, int startId) &#123;</span><br><span class="line">        SharedPreferences pref  = PreferenceManager.getDefaultSharedPreferences(this);</span><br><span class="line">        boolean isUpdateTime = pref.getBoolean(&quot;isUpdateTime&quot;, true);</span><br><span class="line">        if (isUpdateTime == true)&#123;</span><br><span class="line">            updateWeather();</span><br><span class="line">            AlarmManager manager = (AlarmManager) getSystemService(ALARM_SERVICE);</span><br><span class="line">            int autoUpdateTime = pref.getInt(&quot;autoUpdateTime&quot;, 60);</span><br><span class="line">            int anHour = autoUpdateTime * 60 * 1000; // 这是 60 分钟的毫秒数</span><br><span class="line">            long triggerAtTime = SystemClock.elapsedRealtime() + anHour;</span><br><span class="line">            Intent i = new Intent(this, AutoUpdateService.class);</span><br><span class="line">            PendingIntent pi = PendingIntent.getService(this, 0, i, 0);</span><br><span class="line">            manager.cancel(pi);</span><br><span class="line">            manager.set(AlarmManager.ELAPSED_REALTIME_WAKEUP, triggerAtTime, pi);</span><br><span class="line">        &#125;</span><br><span class="line">        return super.onStartCommand(intent, flags, startId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 更新信息</span><br><span class="line">     */</span><br><span class="line">    private void updateWeather()&#123;</span><br><span class="line">        SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);</span><br><span class="line">        String cityName = prefs.getString(&quot;cityName&quot;, null);</span><br><span class="line">        if(cityName != null)&#123;</span><br><span class="line">            String address = &quot;https://api.heweather.com/v5/weather?city=&quot; + cityName + &quot;&amp;key=bc0418b57b2d4918819d3974ac1285d9&quot;;</span><br><span class="line">            HttpUtil.sendOkHttpRequest(address, new Callback() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onFailure(Call call, IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                public void onResponse(Call call, Response response) throws IOException &#123;</span><br><span class="line">                    String responseText = response.body().string();</span><br><span class="line">                    Weather weather = Utility.handleWeatherResponse(responseText);</span><br><span class="line">                    if (weather != null &amp;&amp; &quot;ok&quot;.equals(weather.status))&#123;</span><br><span class="line">                        SharedPreferences.Editor editor = PreferenceManager.getDefaultSharedPreferences(AutoUpdateService.this).edit();</span><br><span class="line">                        editor.putString(&quot;weatherResponse&quot;, responseText);</span><br><span class="line">                        editor.apply();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在 AutoUpdateService 中，updateWeather( )是通过已经存在的缓存文件中得到 cityName 的值，重新发起请求，如果请求成功，并且数据可以成功解析的话，则将成功返回的数据保存在 weatherResponse 中，这样，就可以确保在每次打开该应用程序的时候，应用程序可以解析最新的数据。<br>在 onStartCommand( ) 方法中，我们先查看 isUpdateTime 的值，如果为 false（也就是点击了不进行自动更新），则不执行 updateWeather( ) 方法，如果为 true, 则继续查看 autoUpdateTime 的值，以此来决定定时执行的时间间隔，这样也就完成了定时更新天气数据的任务</p>
<p>至于第三个按钮，也就是关于天气 activity_about_application：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:background=&quot;@color/colorBackground&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.Toolbar</span><br><span class="line">        android:id=&quot;@+id/tool_bar&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;?attr/actionBarSize&quot;</span><br><span class="line">        android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:titleTextColor=&quot;@color/colorFont&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.CardView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_margin=&quot;20dp&quot;</span><br><span class="line">        android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:cardBackgroundColor=&quot;@color/colorWhite&quot;</span><br><span class="line">        app:cardElevation=&quot;2dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;20dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;20dp&quot;</span><br><span class="line">            android:background=&quot;@color/colorWhite&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:layout_width=&quot;80dp&quot;</span><br><span class="line">                android:layout_height=&quot;80dp&quot;</span><br><span class="line">                android:scaleType=&quot;centerCrop&quot;</span><br><span class="line">                android:src=&quot;@mipmap/logo&quot;</span><br><span class="line">                android:layout_gravity=&quot;center_horizontal&quot;</span><br><span class="line">                android:layout_marginTop=&quot;40dp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:text=&quot;版本号 1.0&quot;</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:layout_marginTop=&quot;7dp&quot;</span><br><span class="line">                android:layout_gravity=&quot;center_horizontal&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_marginTop=&quot;80dp&quot;</span><br><span class="line">                android:text=&quot;应用名称  ：   彼时天气&quot;</span><br><span class="line">                android:textSize=&quot;14sp&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:gravity=&quot;left&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_marginTop=&quot;20dp&quot;</span><br><span class="line">                android:text=&quot;应用作者  ：   lentitude&quot;</span><br><span class="line">                android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                android:textSize=&quot;14sp&quot;</span><br><span class="line">                android:gravity=&quot;left&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;LinearLayout</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_marginTop=&quot;10dp&quot;</span><br><span class="line">                android:background=&quot;@android:color/transparent&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;TextView</span><br><span class="line">                    android:text=&quot;Github地址 ：&quot;</span><br><span class="line">                    android:textSize=&quot;14sp&quot;</span><br><span class="line">                    android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                    android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                    android:layout_height=&quot;wrap_content&quot; /&gt;</span><br><span class="line"></span><br><span class="line">                &lt;Button</span><br><span class="line">                    android:id=&quot;@+id/github&quot;</span><br><span class="line">                    android:layout_width=&quot;0dp&quot;</span><br><span class="line">                    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                    android:layout_weight=&quot;1&quot;</span><br><span class="line">                    android:text=&quot;https://Github.com/lentitude&quot;</span><br><span class="line">                    android:textAllCaps=&quot;false&quot;</span><br><span class="line">                    android:background=&quot;@android:color/transparent&quot;</span><br><span class="line">                    android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">            &lt;LinearLayout</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:background=&quot;@android:color/transparent&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;TextView</span><br><span class="line">                    android:text=&quot;CSDN 主页 ：&quot;</span><br><span class="line">                    android:textSize=&quot;14sp&quot;</span><br><span class="line">                    android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                    android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                    android:layout_height=&quot;wrap_content&quot; /&gt;</span><br><span class="line"></span><br><span class="line">                &lt;Button</span><br><span class="line">                    android:id=&quot;@+id/csdn&quot;</span><br><span class="line">                    android:layout_width=&quot;0dp&quot;</span><br><span class="line">                    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                    android:layout_weight=&quot;1&quot;</span><br><span class="line">                    android:text=&quot;http://blog.csdn.net/yiwei12&quot;</span><br><span class="line">                    android:textAllCaps=&quot;false&quot;</span><br><span class="line">                    android:background=&quot;@android:color/transparent&quot;</span><br><span class="line">                    android:textColor=&quot;@color/colorFont&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/android.support.v7.widget.CardView&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最主要的，这里放置了我的 Github 和 CSDN 按钮，如果大家没事，可以点击按钮给颗星星</p>
<p>AboutApplicationActivity：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">package com.example.coolweather;</span><br><span class="line"></span><br><span class="line">import android.content.Intent;</span><br><span class="line">import android.net.Uri;</span><br><span class="line">import android.support.v7.app.ActionBar;</span><br><span class="line">import android.support.v7.app.AppCompatActivity;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.support.v7.widget.Toolbar;</span><br><span class="line">import android.view.MenuItem;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.widget.Button;</span><br><span class="line"></span><br><span class="line">public class AboutApplicationActivity extends BaseActivity &#123;</span><br><span class="line"></span><br><span class="line">    private Button github;</span><br><span class="line">    private Button csdn;</span><br><span class="line">    @Override</span><br><span class="line">    public void initView() &#123;</span><br><span class="line">        setContentView(R.layout.activity_about_application);</span><br><span class="line"></span><br><span class="line">        Toolbar toolbar = (Toolbar)findViewById(R.id.tool_bar);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        ActionBar actionBar = getSupportActionBar();</span><br><span class="line">        if (actionBar != null)&#123;</span><br><span class="line">            actionBar.setTitle(&quot;关于天气&quot;);</span><br><span class="line">            actionBar.setDisplayHomeAsUpEnabled(true);</span><br><span class="line">        &#125;</span><br><span class="line">        github = (Button)findViewById(R.id.github);</span><br><span class="line">        csdn = (Button)findViewById(R.id.csdn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initData() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initListener() &#123;</span><br><span class="line">        github.setOnClickListener(this);</span><br><span class="line">        csdn.setOnClickListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        Intent intent = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        switch (v.getId())&#123;</span><br><span class="line">            case R.id.github:</span><br><span class="line">                intent.setData(Uri.parse(&quot;http://Github.com/lentitude&quot;));</span><br><span class="line">                break;</span><br><span class="line">            case R.id.csdn:</span><br><span class="line">                intent.setData(Uri.parse(&quot;http://blog.csdn.net/yiwei12&quot;));</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onOptionsItemSelected(MenuItem item) &#123;</span><br><span class="line">        switch (item.getItemId())&#123;</span><br><span class="line">            case android.R.id.home:</span><br><span class="line">                finish();</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>截止现在，功能基本都实现了，还差一个重要的功能，<strong>夜间模式</strong>，当然夜间模式有很多实现方式，我这里使用的是限定符的方式：在 res 目录下新建一个 values-night 文件夹，用来存放 夜间模式采用的自定义文件</p>
<p>在 values 中的 color 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;color name=&quot;colorPrimary&quot;&gt;#3F51B5&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorPrimaryDark&quot;&gt;#303F9F&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorAccent&quot;&gt;#757575&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorFont&quot;&gt;#757575&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorBackground&quot;&gt;#f5f5f5&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorWhite&quot;&gt;#ffffff&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorBlack&quot;&gt;#000000&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorRed&quot;&gt;#E91E63&lt;/color&gt;</span><br><span class="line">&lt;/resources&gt;</span><br></pre></td></tr></table></figure>

<p>在 values-night 中的 color 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;resources&gt;</span><br><span class="line">    &lt;color name=&quot;colorPrimary&quot;&gt;#607D8B&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorPrimaryDark&quot;&gt;#607D8B&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorAccent&quot;&gt;#607D8B&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorFont&quot;&gt;#f5f5f5&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorBackground&quot;&gt;#455A64&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorWhite&quot;&gt;#607D8B&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorBlack&quot;&gt;#ffffff&lt;/color&gt;</span><br><span class="line">    &lt;color name=&quot;colorRed&quot;&gt;#00BCD4&lt;/color&gt;</span><br><span class="line">&lt;/resources&gt;</span><br></pre></td></tr></table></figure>

<p>这样，在系统调用夜间模式时，会调用 values-night 中的 color 文件，否则会调用 values 中的 color 文件</p>
<p>重写 BaseApplication</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">public class BaseApplication extends Application &#123;</span><br><span class="line">    private static Context context;</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        context = getApplicationContext();</span><br><span class="line">        LitePal.initialize(context);</span><br><span class="line">        super.onCreate();</span><br><span class="line">        showTheme();</span><br><span class="line">        registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacks() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onActivityCreated(Activity activity, Bundle savedInstanceState) &#123;</span><br><span class="line">                TaskKiller.addActivity(activity);</span><br><span class="line">                // 用来对每一个 Activity 进行监听, 包括第三方 Activity</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onActivityStarted(Activity activity) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onActivityResumed(Activity activity) &#123;</span><br><span class="line">                showTheme();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onActivityPaused(Activity activity) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onActivityStopped(Activity activity) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onActivitySaveInstanceState(Activity activity, Bundle outState) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onActivityDestroyed(Activity activity) &#123;</span><br><span class="line">                TaskKiller.dropActivity(activity);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public void showTheme()&#123;</span><br><span class="line">        SharedPreferences pref = PreferenceManager.getDefaultSharedPreferences(getContext());</span><br><span class="line">        boolean isNight = pref.getBoolean(&quot;isNight&quot;,false);</span><br><span class="line">        if (isNight)&#123;</span><br><span class="line">            AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_YES);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Context getContext()&#123;</span><br><span class="line">        return context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为重写了 BaseApplication ，所以需要将 AndroidManifest 中的 name属性改为 .BaseApplication，那 LitePal 不能获取到 Context 怎么办呢？我们可以在 Application 的 onCreate( ) 方法中调用 LitePal.initialize(context) 对LitePal 进行初始化，效果也是一样的。在showTheme( )方法中，根据 isNight 的值来判定应用使用的主题，所以在 onCreate( )中调用该方法作为默认主题，那改变主题之后怎么办？这里实现了registerActivityLifecycleCallbacks 接口，可以在其中监听所有 Activity 的生命周期，在每一个 Activity调用resume( )方法时，调用 showTheme( )方法来改变该 Activity( )的主题，那 MainActivity 已经开启了，怎么处理呢，我们在 MainActivity 的点击事件中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public boolean onOptionsItemSelected(MenuItem item) &#123;</span><br><span class="line">    switch (item.getItemId())&#123;</span><br><span class="line">        case R.id.setting:</span><br><span class="line">            // 跳转到设置界面</span><br><span class="line">            Intent intent1 = new Intent(this, SettingActivity.class);</span><br><span class="line">            intent1.putExtra(&quot;weather_title&quot;,&quot;设置&quot;);</span><br><span class="line">            startActivity(intent1);</span><br><span class="line">            break;</span><br><span class="line">        case R.id.night_model:</span><br><span class="line">            SharedPreferences pref = PreferenceManager.getDefaultSharedPreferences(this);</span><br><span class="line">            SharedPreferences.Editor editor = pref.edit();</span><br><span class="line">            boolean isNight = pref.getBoolean(&quot;isNight&quot;, false);</span><br><span class="line">            if (isNight)&#123;</span><br><span class="line">                // 如果已经是夜间模式</span><br><span class="line">                getDelegate().setLocalNightMode(AppCompatDelegate.MODE_NIGHT_NO);</span><br><span class="line">                recreate();</span><br><span class="line">                editor.putBoolean(&quot;isNight&quot;, false);</span><br><span class="line">                editor.apply();</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                // 如果是日间模式</span><br><span class="line">                getDelegate().setLocalNightMode(AppCompatDelegate.MODE_NIGHT_YES);</span><br><span class="line">                recreate();</span><br><span class="line">                editor.putBoolean(&quot;isNight&quot;, true);</span><br><span class="line">                editor.apply();</span><br><span class="line">            &#125;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据 isNight 的值来判断要使用什么模式，同时对界面进行重绘，修改 isNight 的值，这样就解决了所有 Activity 的模式转化</p>
<hr>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>好吧，我也没有想到会有这么长，但是毕竟是写完了，如果大家喜欢，给个星吧</p>
<hr>
<h3 id="完整代码下载地址（Github）"><a href="#完整代码下载地址（Github）" class="headerlink" title="完整代码下载地址（Github）"></a>完整代码下载地址（Github）</h3><p><a href="https://github.com/lentitude/BS-Weather">https://github.com/lentitude/BS-Weather</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">lentitude</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://github.com/lentitude/lentitude.github.io/2017/12/22/%E5%81%9A%E4%B8%80%E6%AC%BE%E5%8F%AF%E7%94%A8%E7%9A%84%E5%A4%A9%E6%B0%94-APP/">https://github.com/lentitude/lentitude.github.io/2017/12/22/%E5%81%9A%E4%B8%80%E6%AC%BE%E5%8F%AF%E7%94%A8%E7%9A%84%E5%A4%A9%E6%B0%94-APP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://github.com/lentitude/lentitude.github.io" target="_blank">blogs</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/lentitude/lentitude.github.io/tags/APP/">APP</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/lentitude/lentitude.github.io/2018/01/15/%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E2%80%94%E9%A2%91%E7%B9%81%E9%A1%B9%E9%9B%86Apriori%E7%AE%97%E6%B3%95/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/lentitude/lentitude.github.io/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">关联规则—频繁项集Apriori算法</div></div></a></div><div class="next-post pull-right"><a href="/lentitude/lentitude.github.io/2017/12/22/%E5%81%9A%E4%B8%80%E6%AC%BE%E6%96%B0%E9%97%BB-APP/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/lentitude/lentitude.github.io/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">做一款新闻 APP</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/lentitude/lentitude.github.io/2017/12/22/做一款新闻-APP/" title="做一款新闻 APP"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-12-22</div><div class="title">做一款新闻 APP</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/lentitude/lentitude.github.io/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">lentitude</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/lentitude/lentitude.github.io/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div><div class="card-info-data-item is-center"><a href="/lentitude/lentitude.github.io/tags/"><div class="headline">标签</div><div class="length-num">22</div></a></div><div class="card-info-data-item is-center"><a href="/lentitude/lentitude.github.io/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a class="button--animated" id="card-info-btn" href="https://github.com/lentitude/lentitude.github.io"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">感谢访问本站，若喜欢请收藏 ^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E6%80%9D%E8%B7%AF"><span class="toc-number">1.</span> <span class="toc-text">总体思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8CGIF"><span class="toc-number">2.</span> <span class="toc-text">运行GIF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.</span> <span class="toc-text">步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E6%9D%83%E9%99%90"><span class="toc-number">3.1.</span> <span class="toc-text">声明权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%BA%93"><span class="toc-number">3.2.</span> <span class="toc-text">依赖库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-number">3.3.</span> <span class="toc-text">网络请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%A7%A3%E6%9E%90"><span class="toc-number">3.4.</span> <span class="toc-text">网络解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2%E5%B8%83%E5%B1%80"><span class="toc-number">3.5.</span> <span class="toc-text">界面布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">3.6.</span> <span class="toc-text">最后</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%EF%BC%88Github%EF%BC%89"><span class="toc-number">3.7.</span> <span class="toc-text">完整代码下载地址（Github）</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/lentitude/lentitude.github.io/2021/06/02/hello-world/" title="Hello World"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/lentitude/lentitude.github.io/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/lentitude/lentitude.github.io/2021/06/02/hello-world/" title="Hello World">Hello World</a><time datetime="2021-06-01T18:16:51.662Z" title="发表于 2021-06-02 02:16:51">2021-06-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/lentitude/lentitude.github.io/2020/03/27/MY-LOVE/" title="MY LOVE"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/lentitude/lentitude.github.io/img/404.jpg'" alt="MY LOVE"/></a><div class="content"><a class="title" href="/lentitude/lentitude.github.io/2020/03/27/MY-LOVE/" title="MY LOVE">MY LOVE</a><time datetime="2020-03-26T18:50:23.000Z" title="发表于 2020-03-27 02:50:23">2020-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/lentitude/lentitude.github.io/2019/09/04/Clean-Code%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0%EF%BC%9A%E9%80%90%E6%AD%A5%E6%94%B9%E8%BF%9B/" title="Clean Code第十四章-逐步改进"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/lentitude/lentitude.github.io/img/404.jpg'" alt="Clean Code第十四章-逐步改进"/></a><div class="content"><a class="title" href="/lentitude/lentitude.github.io/2019/09/04/Clean-Code%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0%EF%BC%9A%E9%80%90%E6%AD%A5%E6%94%B9%E8%BF%9B/" title="Clean Code第十四章-逐步改进">Clean Code第十四章-逐步改进</a><time datetime="2019-09-03T16:09:52.000Z" title="发表于 2019-09-04 00:09:52">2019-09-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/lentitude/lentitude.github.io/2019/08/01/Shell-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="Shell 常用命令"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/lentitude/lentitude.github.io/img/404.jpg'" alt="Shell 常用命令"/></a><div class="content"><a class="title" href="/lentitude/lentitude.github.io/2019/08/01/Shell-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="Shell 常用命令">Shell 常用命令</a><time datetime="2019-07-31T16:22:52.000Z" title="发表于 2019-08-01 00:22:52">2019-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/lentitude/lentitude.github.io/2019/07/09/Clean-Code%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E6%B3%A8%E8%A7%A3/" title="Clean Code第四章-注解"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/lentitude/lentitude.github.io/img/404.jpg'" alt="Clean Code第四章-注解"/></a><div class="content"><a class="title" href="/lentitude/lentitude.github.io/2019/07/09/Clean-Code%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E6%B3%A8%E8%A7%A3/" title="Clean Code第四章-注解">Clean Code第四章-注解</a><time datetime="2019-07-08T16:14:55.000Z" title="发表于 2019-07-09 00:14:55">2019-07-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By lentitude</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/lentitude/lentitude.github.io/js/utils.js"></script><script src="/lentitude/lentitude.github.io/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>